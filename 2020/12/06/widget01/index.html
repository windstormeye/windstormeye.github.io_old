<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="也就骑个车，顺便写点码，再去看看景"><title>从实际问题看 SwiftUI 和 Widget 编程 | PJHubs</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">从实际问题看 SwiftUI 和 Widget 编程</h1><a id="logo" href="/.">PJHubs</a><p class="description">也就骑个车，顺便写点码，再去看看景</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined"> 文章</i></a><a href="/archives/"><i class="fa undefined"> 总览</i></a><a href="/photograph/"><i class="fa undefined"> 摄影</i></a><a href="/about/"><i class="fa undefined"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">从实际问题看 SwiftUI 和 Widget 编程</h1><div class="post-meta">2020-12-06</div><div class="post-content"><p><img src="/images/qiniu_img/20201207102254.png"></p>
<p>Widget 的实现依赖 SwiftUI，SwiftUI 部分的内容推荐大家自行学习，给出了一些质量较高的文章，可以配置 WWDC19&#x2F;20 SwiftUI 相关 session 搭配食用。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>推荐看完 WWDC20 Widget Code-Along 三个环节<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/wwdc20/10034">https://developer.apple.com/wwdc20/10034</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/wwdc20/10035">https://developer.apple.com/wwdc20/10035</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/wwdc20/10036">https://developer.apple.com/wwdc20/10036</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/widgetkit/timelineprovider">TimelineProvider</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/cn/news/?id=yv6so7ie">小组件编程临摹课程</a></li>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/SwiftOldDriver/blog/4528390">当 Widget 遇到智能化</a></li>
</ul>
<p>Demo 工程：<a target="_blank" rel="noopener" href="https://github.com/windstormeye/SwiftUIWidget">SwiftUIWidget</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>iOS14 的 Widget 和 iOS14 之前的 Widget 已经完成了统一，之前老样式的 Widget 只能通过在老版本上进行查看，后续仅支持 iOS14 目前的 Widget。只能使用 SwiftUI 进行开发。</p>
<h2 id="Widget-核心"><a href="#Widget-核心" class="headerlink" title="Widget 核心"></a>Widget 核心</h2><ul>
<li>快速、关联性、个性化</li>
<li>看一眼，就能够获取到重点内容</li>
<li>内容才是最重要的<ul>
<li>相册 Widget 注意到的话，会发现展示的照片总是某个时刻下最棒的那一张，而不是最新的。</li>
</ul>
</li>
</ul>
<p>Widget 不是 mini app，应该看作是把 app 的内容在主屏幕的映射关系。官方给出的数据，一般我们会在一天的时间里进入主屏幕超过 90 次，并在主屏幕上短暂停留。</p>
<h2 id="Widget-类型"><a href="#Widget-类型" class="headerlink" title="Widget 类型"></a>Widget 类型</h2><p>Widget 有三个尺寸，但不强迫每个尺寸都实现，因为不是所有 app 都适合全尺寸 widget 展示，但推荐都实现（猜测就是要给用户最大自由度。</p>
<p><img src="/images/qiniu_img/20201207102329.png"></p>
<ul>
<li>不能滚动和不能添加开关等其它系统控件。</li>
<li>不支持视频和动图。</li>
<li>小组件并不是在主屏幕上实时展示的。<ul>
<li>系统的时钟 Widget 的事实刷新 UI 是个系统级 app 才能拥有的对待。</li>
<li>SwiftUI 中对 <code>Text</code> 组件新增了可以实时展示时间的 API。<ul>
<li><code>Text(Date(), style: .time)</code></li>
</ul>
</li>
</ul>
</li>
<li>不要把小尺寸组件直接拉伸成中或者大尺寸小组件。</li>
<li>Small 尺寸组件只能接受单次点击。</li>
<li>小组件内部按照 16pt 设定布局边距。</li>
<li>小组件内部有圆形素材，应该使用 11pt 边距。</li>
<li>小组件内部边界有圆角时要做得跟小组件本身的圆角半径同心。<ul>
<li>不同设备上的小组件本身圆角值不一样，不能直接写死圆角值。</li>
<li>SwiftUI 中提供了一个圆角容器。</li>
</ul>
</li>
<li>字体官方推荐使用 SF 系列，可自定义。</li>
<li>不要放入 app logo 和 name。</li>
</ul>
<h2 id="Widget-如何成组？"><a href="#Widget-如何成组？" class="headerlink" title="Widget 如何成组？"></a>Widget 如何成组？</h2><p>控制允许用户选择的小组件类型</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PJWidget</span>: <span class="title class_">Widget</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> kind: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;PJWidget&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">WidgetConfiguration</span> &#123;</span><br><span class="line">        <span class="type">StaticConfiguration</span>(kind: kind, provider: <span class="type">Provider</span>()) &#123; entry <span class="keyword">in</span></span><br><span class="line">            <span class="type">PJWidgetEntryView</span>(entry: entry)</span><br><span class="line">        &#125;</span><br><span class="line">        .configurationDisplayName(<span class="string">&quot;PJWidget&quot;</span>)</span><br><span class="line">        .description(<span class="string">&quot;2333&quot;</span>)</span><br><span class="line">        .supportedFamilies([.systemSmall, .systemMedium])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在构建 <code>entryView</code> 时，根据当前选择的 <code>widgetFamily</code> 值来返回不同的样式。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PJWidgetEntryView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> entry: <span class="type">Provider</span>.<span class="type">Entry</span></span><br><span class="line">    <span class="meta">@Environment</span>(\.widgetFamily) <span class="keyword">var</span> family</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ViewBuilder</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> family &#123;</span><br><span class="line">        <span class="keyword">case</span> .systemSmall:</span><br><span class="line">            <span class="type">PJAvatarView</span>(entry.name)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;PJHubs&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 Xcode Widget Extension 模版创建完后，会自动给默认 Widget 加上 <code>@main</code> 修饰符标记出当前 app Widget 的入口。</p>
<p>换句话说，此时我们进入到「Widget 搜索」，找到我们的 app，只会看到一个 Widget。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SwiftUIWidgetDemo</span>: <span class="title class_">Widget</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> kind: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;SwiftUIWidgetDemo&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">WidgetConfiguration</span> &#123;</span><br><span class="line">        <span class="type">IntentConfiguration</span>(kind: kind, intent: <span class="type">ConfigurationIntent</span>.<span class="keyword">self</span>, provider: <span class="type">Provider</span>()) &#123; entry <span class="keyword">in</span></span><br><span class="line">            <span class="type">SwiftUIWidgetDemoEntryView</span>(entry: entry)</span><br><span class="line">        &#125;</span><br><span class="line">        .configurationDisplayName(<span class="string">&quot;西瓜作者-数据日报&quot;</span>)</span><br><span class="line">        .description(<span class="string">&quot;你的数据精简日报&quot;</span>)</span><br><span class="line">        .supportedFamilies([.systemSmall])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/qiniu_img/20201207103211.png"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Widgets</span>: <span class="title class_">WidgetBundle</span> &#123;</span><br><span class="line">    <span class="meta">@WidgetBundleBuilder</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Widget</span> &#123;</span><br><span class="line">        <span class="type">SwiftUIWidgetDemo</span>()</span><br><span class="line">        <span class="type">SwiftUIWidgeMediumDemo</span>()</span><br><span class="line">        <span class="type">SwiftUIWidgeMediumFansDemo</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：最多只允许塞入五个 Widget 样式。</p>
<h3 id="Tips：What-is-main？"><a href="#Tips：What-is-main？" class="headerlink" title="Tips：What is @main？"></a>Tips：What is <code>@main</code>？</h3><p>说起 <code>@main</code> 大家可能会先想到之前的 <code>@UIApplicationMain</code> 这个修饰词，说到 <code>@UIApplicationMain</code> 可能又会想到 main.swift 或者 main.m 等等这些文件。总的来说，它们之间是存在某种神秘联系的！我们来写一个简单的 Swift 代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">demoSwift</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">func</span> <span class="title class_">test</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;world!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">demoSwift.test()</span><br></pre></td></tr></table></figure>

<p>此时使用 <code>swiftc demo.swift</code> 后会得到一个可执行文件，看上去 Swift 的语法让新上手的同学令人感到愉快，不会再有类 C 系那种必须写一系列又臭又长的 main 函数初始化流程，但本质上真的不用写了吗？<br>我们来看看中间代码。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看生成的中间代码</span></span><br><span class="line">swiftc demo.swift -emit-sil</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sil_stage canonical</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Builtin</span><br><span class="line"><span class="keyword">import</span> Swift</span><br><span class="line"><span class="keyword">import</span> SwiftShims</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">demoSwift</span> &#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">func</span> <span class="title class_">test</span>()</span><br><span class="line">  @<span class="title class_">objc</span> <span class="title class_">deinit</span></span><br><span class="line">  <span class="title class_">init</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// <span class="title class_">main</span></span><br><span class="line"><span class="title class_">sil</span> @<span class="title class_">main</span> : <span class="title class_">$</span>@<span class="title class_">convention</span>(<span class="title class_">c</span>) (<span class="title class_">Int32</span>, <span class="title class_">UnsafeMutablePointer</span>&lt;<span class="title class_">Optional</span>&lt;<span class="title class_">UnsafeMutablePointer</span>&lt;<span class="title class_">Int8</span>&gt;&gt;&gt;) -&gt; <span class="title class_">Int32</span> &#123;</span><br><span class="line">bb0(<span class="operator">%</span><span class="number">0</span> : <span class="variable">$Int32</span>, <span class="operator">%</span><span class="number">1</span> : <span class="variable">$UnsafeMutablePointer</span><span class="operator">&lt;</span><span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;<span class="operator">&gt;</span>):</span><br><span class="line">  <span class="operator">%</span><span class="number">2</span> <span class="operator">=</span> metatype $<span class="meta">@thick</span> demoSwift.<span class="keyword">Type</span>            <span class="comment">// user: %4</span></span><br><span class="line">  <span class="comment">// function_ref static demoSwift.test()</span></span><br><span class="line">  <span class="operator">%</span><span class="number">3</span> <span class="operator">=</span> function_ref @<span class="variable">$s4demo0A5SwiftC4testyyFZ</span> : $<span class="meta">@convention</span>(method) (<span class="meta">@thick</span> demoSwift.<span class="keyword">Type</span>) -&gt; () <span class="comment">// user: %4</span></span><br><span class="line">  <span class="operator">%</span><span class="number">4</span> <span class="operator">=</span> apply <span class="operator">%</span><span class="number">3</span>(<span class="operator">%</span><span class="number">2</span>) : $<span class="meta">@convention</span>(method) (<span class="meta">@thick</span> demoSwift.<span class="keyword">Type</span>) -&gt; ()</span><br><span class="line">  <span class="operator">%</span><span class="number">5</span> <span class="operator">=</span> integer_literal <span class="variable">$Builtin</span>.<span class="type">Int32</span>, <span class="number">0</span>          <span class="comment">// user: %6</span></span><br><span class="line">  <span class="operator">%</span><span class="number">6</span> <span class="operator">=</span> <span class="keyword">struct</span> <span class="title class_">$Int32</span> (%5 : <span class="title class_">$Builtin</span>.<span class="title class_">Int32</span>)        // <span class="title class_">user</span>: %7</span><br><span class="line">  <span class="title class_">return</span> %6 : <span class="title class_">$Int32</span>                              // <span class="title class_">id</span>: %7</span><br><span class="line">&#125; // <span class="title class_">end</span> <span class="title class_">sil</span> <span class="title class_">function</span> &#x27;<span class="title class_">main</span>&#x27;</span><br><span class="line"></span><br><span class="line">// ... 以下省略</span><br></pre></td></tr></table></figure>

<p>可以看到，所谓的对新人友好都是假的，全都是编译期间 <code>swiftc</code> 做的自动化插入，自动给我们的方法插入了与之前类似的流程，如果我们需要多文件编译依赖，要有一个 main.swift 作为入口文件进行索引其他文件进行编译。<br><code>@UIApplicationMain</code> 出现后，我们不再需要 main.swift 文件来做入口切割，可通过自定义类并加上该标记即可，这个好处在 Swift 5.3 中正式推广到语言层面，我们仅需使用 <code>@main</code> 即可标记出 Swift 文件的入口，不再是 Cocoa 特性，进而替代掉了 <code>@UIApplicationMain</code>。</p>
<h2 id="Widget-用户如何配置数据？"><a href="#Widget-用户如何配置数据？" class="headerlink" title="Widget 用户如何配置数据？"></a>Widget 用户如何配置数据？</h2><p>Widget 提供了用户可配置数据源的方式，可以通过此类方式来绕过 Widget 成组后最大上限五个的限制。提供两种配置方式</p>
<ul>
<li>StaticConfiguration。用户不可自定义数据源，参考头条 Widget。<br><img src="/images/qiniu_img/20201207103106.png"></li>
<li>IntentCOnfiguration。允许用户选择配置，参考下图。<br><img src="/images/qiniu_img/20201207103610.png"></li>
</ul>
<p>其中 IntentConfiguration 可提供给用户有限的“自由”，自行选择对应 Widget 下需要展示的数据源。利用了基于 Intents.framework 框架实现，并可以直接复用 SiriKit 的功能来达到 Widget 的智能化（后文再叙）。</p>
<p>配置 IntentConfiguration 的步骤如下：</p>
<ul>
<li>创建对应的 IntentConfiguration 文件。</li>
</ul>
<p><img src="/images/qiniu_img/20201207103329.png"></p>
<ul>
<li>新增用户可配置的数据类型</li>
</ul>
<p><img src="/images/qiniu_img/20201207103355.png"></p>
<ul>
<li>配置新增数据类型相关信息</li>
</ul>
<p><img src="/images/qiniu_img/20201207103420.png"></p>
<ul>
<li>在对应类型的 Widget 中判断数据视图</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SwiftUIWidgetDemoMediumEntryView</span> : <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> entry: <span class="type">Provider</span>.<span class="type">Entry</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ViewBuilder</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> entry.configuration.countType &#123;</span><br><span class="line">        <span class="keyword">case</span> .money:</span><br><span class="line">            <span class="comment">// 此处需传入数据源</span></span><br><span class="line">            <span class="type">MediumWidgetFansView</span>()</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="comment">// 此处需传入数据源</span></span><br><span class="line">            <span class="type">MediumWidgetView</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Tips-What-is-ViewBuilder"><a href="#Tips-What-is-ViewBuilder" class="headerlink" title="Tips: What is @ViewBuilder"></a>Tips: What is <code>@ViewBuilder</code></h3><p><a href="http://pjhubs.com/2019/11/09/swiftUIandCombine01/">从实际问题看 SwiftUI 和 Combine 编程</a> 已说明，可以前往了解。</p>
<h2 id="Widget-如何跳转到对应的页面？"><a href="#Widget-如何跳转到对应的页面？" class="headerlink" title="Widget 如何跳转到对应的页面？"></a>Widget 如何跳转到对应的页面？</h2><h3 id="预览视图"><a href="#预览视图" class="headerlink" title="预览视图"></a>预览视图</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Provider</span>: <span class="title class_">IntentTimelineProvider</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> 小组件占位视图，第一次添加或 loading 状态中的视图</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">placeholder</span>(<span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">SimpleEntry</span> &#123;</span><br><span class="line">        <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>(), count: <span class="number">0</span>, image: <span class="literal">nil</span>, configuration: <span class="type">ConfigurationIntent</span>())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> 第一次添加或小组件第一次被展示时调用</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getSnapshot</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">SimpleEntry</span>) -&gt; ()) &#123;</span><br><span class="line">        <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>(), count: <span class="number">0</span>, image: <span class="literal">nil</span>, configuration: configuration)</span><br><span class="line">        completion(entry)</span><br><span class="line">    &#125;</span><br><span class="line">                </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getTimeline</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Timeline</span>&lt;<span class="type">Entry</span>&gt;) -&gt; ()) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">let</span> timeline <span class="operator">=</span> <span class="type">Timeline</span>(entries: entries, policy: .atEnd)</span><br><span class="line">        completion(timeline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>placeholder方法中返回 widget 在初始化 loading 过程中的占位 UI。</p>
<ul>
<li>每一个 widget 都必须提供。</li>
<li>默认内容展示。</li>
<li>没有任何用户相关数据。</li>
<li>当系统无法显示你的小组件数据时会出现。</li>
<li>无法被告知什么时候应该展示占位图。这是系统行为，系统需要的时候就会要求展示，例如用户更换了 widget 尺寸等。<br><img src="/images/qiniu_img/20201207103745.png"></li>
</ul>
<p>这个视图是系统行为，只要我们使用的是标准 SwiftUI 组件，会自动根据组件类型，如 <code>Image</code>、<code>Text</code> 结合我们自定义的颜色和背景来自动完成占位图的设置，如果我们不想要的系统自定义的话，也可以在方法中自行返回自定义的占位组件。</p>
<p>注意点：在构建 <code>PlaceHolderView</code> 时，Session 中所给的 <code>isPlaceHoler</code> 通过属性的方式去做已经不行了，得通过以下方式来进行（如果我们需要预览的话）：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PJWidgetEntryView</span>(entry: <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>())).redacted(reason: .placeholder)</span><br></pre></td></tr></table></figure>

<h3 id="跳转"><a href="#跳转" class="headerlink" title="跳转"></a>跳转</h3><p>Widget 的目的非常简单，目前在 Widget 上所做的事情，全都是为了引导用户可以轻松的点击小组件和通过 deepLink 跳转到我们的 app 中。而从 Widget 跳转到 app 中针对不同类型的 Widget 有共有两种跳转方式。</p>
<ul>
<li><p><code>.widgetURL</code></p>
<ul>
<li>三种类型的小组件均可使用该方式进行跳转。<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SmallWidgetView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment:.leading) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;PJHubs&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .widgetURL(<span class="type">URL</span>(string: <span class="string">&quot;urlschema://pjhubsWidgetURL&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>Link</code></p>
<ul>
<li>只有 Medium 和 Large 类型的小组件可以使用该方式进行跳转。</li>
<li>Small 类型小组件编译没问题，点击后无回调。<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">MediumWidgetView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Link</span>(destination:<span class="type">URL</span>(string: <span class="string">&quot;urlschema://pjhubsLink&quot;</span>)<span class="operator">!</span>) &#123;</span><br><span class="line">            <span class="type">VStack</span>(alignment:.leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;PJHubs&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>SceneDelegate.m 中的内容为：</p>
<ul>
<li>可以直接复用以往主工程通过消息通知 push 的逻辑流程来打开 widget 上挂载的 schema。<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &quot;SceneDelegate.h&quot;</span><br><span class="line">#<span class="keyword">import</span> &quot;WidgetURLViewController.h&quot;</span><br><span class="line">#<span class="keyword">import</span> &quot;LinkViewController.h&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">@implementation</span> <span class="type">SceneDelegate</span></span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> (void)scene:(<span class="type">UIScene</span> <span class="operator">*</span>)scene openURLContexts:(<span class="type">NSSet</span>&lt;<span class="type">UIOpenURLContext</span> *&gt; <span class="operator">*</span>)<span class="type">URLContexts</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="type">URLContexts</span>.allObjects.count <span class="operator">!=</span> <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">UIOpenURLContext</span> <span class="operator">*</span>urlContext <span class="operator">=</span> <span class="type">URLContexts</span>.allObjects.firstObject;</span><br><span class="line">        <span class="type">NSURL</span> <span class="operator">*</span>url <span class="operator">=</span> urlContext.<span class="type">URL</span>;</span><br><span class="line">        <span class="keyword">if</span> ([url.absoluteString isEqualToString:@<span class="string">&quot;urlschema://pjhubsWidgetURL&quot;</span>]) &#123;</span><br><span class="line">            [<span class="keyword">self</span>.window.rootViewController presentViewController:[<span class="type">WidgetURLViewController</span> new] animated:<span class="type">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ([url.absoluteString isEqualToString:@<span class="string">&quot;urlschema://pjhubsLink&quot;</span>]) &#123;</span><br><span class="line">            [<span class="keyword">self</span>.window.rootViewController presentViewController:[<span class="type">LinkViewController</span> new] animated:<span class="type">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@end</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><ul>
<li>调试 Widget Deep Link 跳转时需要切换到 app target 下进行调试，一直在用 Widget target 调，发现断点一直走不进去，才猛的想起来，我在 widget target 里能断在 app target 里才奇了怪了。</li>
<li>更新 widget 的内容后，需要 build 一遍 widget target，然后再回到 app target 走 app 生命周期相关方法。</li>
</ul>
<h3 id="Tips-如果-OC-View-想要被使用在-SwiftUI-中。"><a href="#Tips-如果-OC-View-想要被使用在-SwiftUI-中。" class="headerlink" title="Tips: 如果 OC View 想要被使用在 SwiftUI 中。"></a>Tips: 如果 OC View 想要被使用在 SwiftUI 中。</h3><ul>
<li>首先创建或确定要被引入 SwiftUI 中的 OC 视图，下文以 OCView 替代。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;OCView.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation OCView</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    if (self = [super initWithFrame:frame]) &#123;</span><br><span class="line">        [self initView];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initView &#123;</span><br><span class="line">    self.backgroundColor = [UIColor whiteColor];</span><br><span class="line">    </span><br><span class="line">    UILabel *textLabel = [[UILabel alloc] init];</span><br><span class="line">    textLabel.text = @&quot;这是 OC View&quot;;</span><br><span class="line">    textLabel.font = [UIFont systemFontOfSize:30];</span><br><span class="line">    [textLabel sizeToFit];</span><br><span class="line">    textLabel.frame = CGRectMake((self.frame.size.width - textLabel.frame.size.width)/2, (self.frame.size.height - textLabel.frame.size.height)/2, textLabel.frame.size.width, textLabel.frame.size.height);</span><br><span class="line">    [self addSubview:textLabel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<ul>
<li>创建一个 OCWidgetView.swift 文件，用于封装 SwiftUI 视图。</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">OCWidgetView</span>: <span class="title class_">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">OCView</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">OCView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="type">OCView</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SwiftUI 中提供了 <code>Coordinator</code> 这个理念来作为 <code>OCView</code> 可能存在的各种 delegate 相关回调事件，在 SwiftUI 中同样可以进行使用，在此不做展开。</p>
<p>此时就可以在 SwiftUI 中引入 OCWidgetView 了！</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">MediumWidgetFansView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment:.leading) &#123;</span><br><span class="line">            <span class="type">OCWidgetView</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Widget 的 UI 部分只能使用 SwiftUI 框架下的 UI 组件，不能使用任何 UIKit 相关的组件，就算用 SwiftUI 包一层也不行（UIViewRepresentable），强行使用的话，会在 Widget 视图上得到一个黄色背景红叉：<br><img src="/images/qiniu_img/20201207104139.png"></p>
<h2 id="Widget-如何更新数据？"><a href="#Widget-如何更新数据？" class="headerlink" title="Widget 如何更新数据？"></a>Widget 如何更新数据？</h2><h3 id="刷新时机"><a href="#刷新时机" class="headerlink" title="刷新时机"></a>刷新时机</h3><h4 id="Timeline-刷新"><a href="#Timeline-刷新" class="headerlink" title="Timeline 刷新"></a>Timeline 刷新</h4><p>Widget 需要通过 Timeline 来进行数据刷新，但其刷新的时机由系统控制，但有时我们设置了刷新间隔时间也不一定会在该时间点进行刷新。</p>
<p>如果我们完全依赖 Widget 自身的数据更新策略，每次间隔 1s 刷新数据，每次更新时拉取 5 个数据，设置 Timeline policy为 <code>.atEnd</code>，也即当 timeline 中的数据用完后立即拉取下一条数据，则最短也许要 1min 时间才能拉取下一条 timeline（自测）。</p>
<ul>
<li><code>atEnd</code>: 拉取到最后一个数据后重新拉取。</li>
<li><code>atAfter</code>: 在指定时间后以一定时间间隔拉取数据。</li>
<li><code>never</code>：该 timeline 不需要刷新。</li>
</ul>
<p>不是都需要一次在 timeline 中构造好多个数据实体，可以一次返回一个，刷新间隔设置为 1min（或其它时间），这样比较适合对数据实时性要求较高的产品。系统并不少按照我们所规定的那样执行逻辑，系统考虑的因素用官方的话语来说，要结合耗电量等等问题综合给到不同 Widget 的刷新时机和此时，但总的来说，经常被查看的 widget 会获得更多的刷新机会。</p>
<h4 id="主动刷新"><a href="#主动刷新" class="headerlink" title="主动刷新"></a>主动刷新</h4><p>如果我们想要在 app 内主动同步 widget 上所展示的消息，或在当前时刻必须刷新，如“开言英语” Widget 用户登录前后的 UI 表现不同等，在这种需求背景下，我们可以使用 WidgetKit 的 WidgetCenter API 来完成。</p>
<p><img src="/images/qiniu_img/20201207104248.png"></p>
<p><code>WidgetCenter.shared.reloadAllTimelines()</code>。<code>reloadAllTimelines</code> 方法会重新 load 所属 app 内的所有已配置的 Widget，重新拉取 Timeline。</p>
<p>需要注意的是，WidgetKit 为 Swift Only，想要在 OC 工程中使用该方法刷新 Widget Timeline 得通过 Swift 包一层，且要求 app 处于活跃状态。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WidgetKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span>Members <span class="keyword">class</span> <span class="title class_">PJWidgetCenter</span>: <span class="title class_">NSObject</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">func</span> <span class="title class_">reloadWidgetTimeline</span>() &#123;</span><br><span class="line">        <span class="type">WidgetCenter</span>.shared.reloadAllTimelines();</span><br><span class="line">        <span class="type">WidgetCenter</span>.shared.reloadTimelines(ofKind: <span class="string">&quot;What kind of widget?&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>支持所有 widget 刷新或某一个 widget。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &quot;ViewController.h&quot;</span><br><span class="line">#<span class="keyword">import</span> &quot;SwiftUIWidget-Swift.h&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">@implementation</span> <span class="type">ViewController</span></span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> (void)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    [<span class="type">PJWidgetCenter</span> reloadWidgetTimeline];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数据来源<br><code>getTimeline</code> 方法支持异步操作，我们如果需要动态的走网络请求拉取构造 timeline 数据，可以直接丢出一个异步回调。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Provider</span>: <span class="title class_">IntentTimelineProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getTimeline</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Timeline</span>&lt;<span class="type">Entry</span>&gt;) -&gt; ()) &#123;</span><br><span class="line">        networkHandler &#123;</span><br><span class="line">            <span class="keyword">let</span> timeline <span class="operator">=</span> <span class="type">Timeline</span>(entries: <span class="variable">$0</span>, policy: .atEnd)</span><br><span class="line">            completion(timeline)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">networkHandler</span>(<span class="params">completion</span>: <span class="keyword">@escaping</span> ([<span class="type">SimpleEntry</span>]) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="type">URLSession</span>.shared.dataTask(with: <span class="type">URL</span>(string: <span class="string">&quot;http://pjhubs.com&quot;</span>)<span class="operator">!</span>) &#123; (data, response, error) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> originalDict <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">JSONSerialization</span>.jsonObject(with: data<span class="operator">!</span>, options: <span class="type">JSONSerialization</span>.<span class="type">ReadingOptions</span>.allowFragments) <span class="keyword">as?</span> <span class="type">NSDictionary</span></span><br><span class="line">            <span class="built_in">print</span>(originalDict <span class="keyword">as</span> <span class="keyword">Any</span>)</span><br><span class="line">            completion([<span class="type">SimpleEntry</span>(date: <span class="type">Date</span>(), count: <span class="number">1234</span>, image: <span class="type">UIImage</span>(named: <span class="string">&quot;avatar&quot;</span>)<span class="operator">!</span>, configuration: <span class="type">ConfigurationIntent</span>())])</span><br><span class="line">        &#125;.resume()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意请求间隔、Timeline 更新时间和数据转换等问题。</p>
<h3 id="数据共享"><a href="#数据共享" class="headerlink" title="数据共享"></a>数据共享</h3><p>以在 Widget 展示用户头像举例，在以往的开发经历中，我们都不希望有同步操作阻塞主线程从而造成 app 卡顿，故在 Widget 中我们也会自然而然的在“图片展示”这一环节中套用异步请求资源的思路去做，但这在 Widget 中是不被允许的，我们需要转变一个思路。</p>
<p>以下这种把图片资源延后到 UI 层的做法可以拉取成功，但不会被加载。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SmallWidgetView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> networkImage: <span class="type">UIImage</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment:.leading) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Image</span>(uiImage: <span class="keyword">self</span>.networkImage <span class="operator">??</span> <span class="type">UIImage</span>(named: <span class="string">&quot;avatar&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">                    <span class="comment">// ...</span></span><br><span class="line">                    .onAppear(perform: getNetworkImage)                </span><br><span class="line">            &#125;       </span><br><span class="line">           <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getNetworkImage</span>() &#123;</span><br><span class="line">        <span class="type">URLSession</span>.shared.dataTask(with: <span class="type">URL</span>(string: <span class="string">&quot;https://tu.sioe.cn/gj/qiege/image.jpg&quot;</span>)<span class="operator">!</span>) &#123; (data, <span class="keyword">_</span>, <span class="keyword">_</span>) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.networkImage <span class="operator">=</span> <span class="type">UIImage</span>(data: data<span class="operator">!</span>)</span><br><span class="line">        &#125;.resume()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决这一问题目前有三种方法但都是一种思路，核心就是把图片的加载过程从异步转化为同步，这个同步的过程可以是在 <code>getTimeline</code> 初始化时间线时，也可以是在构造 Widget UI 层逻辑时。</p>
<ul>
<li>UserDefault</li>
<li>FileManager</li>
<li>CoreData</li>
</ul>
<p>以下为在 getTimeline 初始化时间线时的事例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SmallWidgetView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> uiImage: <span class="type">UIImage</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment:.leading) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Image</span>(uiImage: uiImage <span class="operator">??</span> <span class="type">UIImage</span>(named: <span class="string">&quot;avatar&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">                    <span class="comment">// ...</span></span><br><span class="line">            &#125;       </span><br><span class="line">           <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Provider</span>: <span class="title class_">IntentTimelineProvider</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getTimeline</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Timeline</span>&lt;<span class="type">Entry</span>&gt;) -&gt; ()) &#123;</span><br><span class="line">        <span class="keyword">var</span> entries: [<span class="type">SimpleEntry</span>] <span class="operator">=</span> []</span><br><span class="line">        <span class="keyword">let</span> currentDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">        <span class="keyword">for</span> hourOffset <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> <span class="number">3</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> entryDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .second, value: hourOffset, to: currentDate)<span class="operator">!</span></span><br><span class="line">            <span class="comment">// <span class="doctag">NOTE:</span> 在处理 timeline 时就把资源加载好</span></span><br><span class="line">            <span class="keyword">var</span> image: <span class="type">UIImage</span>? <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> imageData <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">Data</span>(contentsOf: <span class="type">URL</span>(string: <span class="string">&quot;https://tu.sioe.cn/gj/qiege/image.jpg&quot;</span>)<span class="operator">!</span>) &#123;</span><br><span class="line">                image <span class="operator">=</span> <span class="type">UIImage</span>(data: imageData)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: entryDate, count: <span class="type">Int</span>.random(in: <span class="number">0</span><span class="operator">...</span><span class="number">100</span>), image: image, configuration: configuration)</span><br><span class="line">            entries.append(entry)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> timeline <span class="operator">=</span> <span class="type">Timeline</span>(entries: entries, policy: .atEnd)</span><br><span class="line">        completion(timeline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Widget 在最初放出的 beta 版本中是可以支持图片资源的异步回调的，但后来又改成了目前的这种只能通过同步的方式进行资源获取。</p>
<p>如果出现不同类型的 widget 需要复用图片资源，可以使用系统内轻量级 cache 方法（如：<code>NSCache</code>等）来完成在 A 类型 Widget 下已经加载完成的图片资源，后续用户再手动添加 B 类型 Widget 后可以加速 Widget 渲染。</p>
<p>当我们需要从 app target 传递数据到 widget target 时，可以组成 App Groups，通过 <code>UserDefualt</code> 来完成数据传递，注意两个 target 都需要增加 app groups。<br><img src="/images/qiniu_img/20201207104639.png"></p>
<p>在 app target 中设置测试代码，10s 后刷新 widget 的显示内容，以此来模拟真实 app 中主工程触发某个网络事件，等待延时后同步数据给 Widget。</p>
<p>App target</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;ViewController.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&quot;SwiftUIWidget-Swift.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">10</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        [PJWidgetCenter reloadWidgetTimeline];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>Swift 处理过程（非必需）</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WidgetKit</span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span>Members <span class="keyword">class</span> <span class="title class_">PJWidgetCenter</span>: <span class="title class_">NSObject</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">func</span> <span class="title class_">reloadWidgetTimeline</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> userDefaults <span class="operator">=</span> <span class="type">UserDefaults</span>(suiteName: <span class="string">&quot;group.com.pjhubs.swiftuiwidge&quot;</span>) &#123;</span><br><span class="line">            userDefaults.setValue(<span class="string">&quot;2333&quot;</span>, forKey: <span class="string">&quot;integer&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">WidgetCenter</span>.shared.reloadAllTimelines();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Widget</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Provider</span>: <span class="title class_">IntentTimelineProvider</span> &#123;</span><br><span class="line">    <span class="meta">@AppStorage</span>(<span class="string">&quot;integer&quot;</span>, store: <span class="type">UserDefaults</span>(suiteName: <span class="string">&quot;group.com.pjhubs.swiftuiwidge&quot;</span>))</span><br><span class="line">    <span class="keyword">var</span> intString: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//...        </span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getTimeline</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Timeline</span>&lt;<span class="type">Entry</span>&gt;) -&gt; ()) &#123;</span><br><span class="line">        <span class="keyword">var</span> entries: [<span class="type">SimpleEntry</span>] <span class="operator">=</span> []</span><br><span class="line">        <span class="keyword">let</span> currentDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">        <span class="keyword">for</span> hourOffset <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> <span class="number">5</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> entryDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .second, value: hourOffset, to: currentDate)<span class="operator">!</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: entryDate, count: <span class="type">Int</span>(intString)<span class="operator">!</span>, image: image, configuration: configuration)</span><br><span class="line">            entries.append(entry)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> timeline <span class="operator">=</span> <span class="type">Timeline</span>(entries: entries, policy: .atEnd)</span><br><span class="line">        completion(timeline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Widge-如何在「智能堆叠」中提高展示？"><a href="#Widge-如何在「智能堆叠」中提高展示？" class="headerlink" title="Widge 如何在「智能堆叠」中提高展示？"></a>Widge 如何在「智能堆叠」中提高展示？</h2><p><strong>推荐看完 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2020/10194/">为小组件添加智能和配置</a></strong></p>
<p>基于 iOS12 引入的 Intent.framework，目前有两种提高 Widget 在智能堆叠中展示的办法。</p>
<ul>
<li>用户行为捐赠（系统推断）</li>
<li>数据源评分展示（评估函数判分）</li>
</ul>
<h3 id="用户行为捐赠"><a href="#用户行为捐赠" class="headerlink" title="用户行为捐赠"></a>用户行为捐赠</h3><p>WWDC20 Session - 为小组件添加智能和配置视频截图。</p>
<p><img src="/images/qiniu_img/20201207104926.png"></p>
<p>我们可以把一些自定义的关键组合信息构造出一个 intent 捐赠给系统，通过 Intent.framework，系统不但可以把这些信息传递给我们 app widget 还可以传递到 spotlight 等其它依赖 Intent 的场景从而减少进入特定场景&#x2F;app 的步骤。</p>
<p>转换成我们的产品视角，当作者每天都在 14 点查看自己的视频播放量这一个指标数据，可以在作者进入到指标页面时，通过构造 Intent 实例进行捐赠给系统，当累计到一定次数（不定）后，系统会在每天用户 14 点前后解锁进入主屏时，在「智能堆叠」Widget 中自动翻滚到我们加入其中的 Widget 并展示出对应的播放量 Widget。</p>
<p><img src="/images/qiniu_img/20201207104957.png"></p>
<h3 id="数据源评分展示"><a href="#数据源评分展示" class="headerlink" title="数据源评分展示"></a>数据源评分展示</h3><p>如果我们想要在特定时间主动突出小组件在智能堆叠上的展示机会，可以使用「数据源评分展示」策略，在构造 Timeline 时可以给不同的数据实体塞入不同的评分，从而达到在不同时间节点或特定时间节点下的突出展示。</p>
<p>转换成我们的产品视角，当作者新发布了一个视频，可能想要在未来的一天、两天甚至一周内关注视频本身的播放量这一指标，我们可以通过固定分数和持续时间来达到提升展示，从而关闭其它数据源更新时的</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Provider</span>: <span class="title class_">IntentTimelineProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getTimeline</span>(<span class="params">for</span> <span class="params">configuration</span>: <span class="type">ConfigurationIntent</span>, <span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Timeline</span>&lt;<span class="type">Entry</span>&gt;) -&gt; ()) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">for</span> hourOffset <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> <span class="number">3</span> &#123;</span><br><span class="line">           <span class="comment">// ...</span></span><br><span class="line">            <span class="keyword">if</span> (hourOffset <span class="operator">==</span> <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> revelance <span class="operator">=</span> <span class="type">TimelineEntryRelevance</span>(score: <span class="number">2000</span>, duration: <span class="number">60</span>);</span><br><span class="line">                <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: entryDate, count: <span class="number">2000</span>, image: image, configuration: configuration, relevance: revelance)</span><br><span class="line">                entries.append(entry)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> revelance <span class="operator">=</span> <span class="type">TimelineEntryRelevance</span>(score: <span class="number">10</span>, duration: <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: entryDate, count: <span class="type">Int</span>(intString)<span class="operator">!</span>, image: image, configuration: configuration, relevance: revelance)</span><br><span class="line">                entries.append(entry)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> timeline <span class="operator">=</span> <span class="type">Timeline</span>(entries: entries, policy: .atEnd)</span><br><span class="line">        completion(timeline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，我们给在第二分钟时要展现的数据分数 Relevance 分数设置为 2000，其它数据的分数设置为 10 分，此时运行 Widget 并等待到第二分钟，智能堆叠的 Widget 并不会一定翻转到我们的 Widget 上，但 Widget 上的数据是确确实实被更新了的，同时也说明了系统并不会一定认为当前数据比同一个 Widget 下的其它数据评分高，就一定为在智能堆叠上必须展示我们的 Widget，只是说在智能堆叠执行翻转时，我们的 Widget 会获得比其它 Widget 可能会获得更高的展示机会。</p>
<p>并且该评分也仅仅只是和当前 Widget 内的数据源做的对比。</p>
<p><img src="/images/qiniu_img/20201207105108.png"></p>
</div><div class="tags"><a href="/tags/SwiftUI/"><i class="fa fa-tag"></i>SwiftUI</a><a href="/tags/iOS14/"><i class="fa fa-tag"></i>iOS14</a><a href="/tags/Widget/"><i class="fa fa-tag"></i>Widget</a></div><div class="post-nav"><a class="pre" href="/2020/12/11/talk10/">《从兴趣到职业，如何坚持自己的想法》- 信息科大“学海职涯”系列讲座</a><a class="next" href="/2020/11/08/talk05/">2020 信息科大开源软件开发技术选修课 -《开源与我》主题分享</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 15px;">总结</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 15px;">比赛</a> <a href="/tags/Cocos/" style="font-size: 15px;">Cocos</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" style="font-size: 15px;">游戏开发</a> <a href="/tags/DiDi/" style="font-size: 15px;">DiDi</a> <a href="/tags/internship/" style="font-size: 15px;">internship</a> <a href="/tags/Flutter/" style="font-size: 15px;">Flutter</a> <a href="/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0/" style="font-size: 15px;">跨平台</a> <a href="/tags/Audio/" style="font-size: 15px;">Audio</a> <a href="/tags/Ping/" style="font-size: 15px;">Ping</a> <a href="/tags/%E5%BC%B9%E5%B9%95/" style="font-size: 15px;">弹幕</a> <a href="/tags/%E9%A1%B5%E9%9D%A2%E4%BC%A0%E5%80%BC/" style="font-size: 15px;">页面传值</a> <a href="/tags/HUD/" style="font-size: 15px;">HUD</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/%E5%BC%80%E6%BA%90/" style="font-size: 15px;">开源</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 15px;">项目</a> <a href="/tags/PhotosKit/" style="font-size: 15px;">PhotosKit</a> <a href="/tags/React-Native/" style="font-size: 15px;">React-Native</a> <a href="/tags/swift/" style="font-size: 15px;">swift</a> <a href="/tags/Weex/" style="font-size: 15px;">Weex</a> <a href="/tags/Apple/" style="font-size: 15px;">Apple</a> <a href="/tags/%E6%84%9F%E6%83%B3/" style="font-size: 15px;">感想</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">博客</a> <a href="/tags/%E4%BA%91/" style="font-size: 15px;">云</a> <a href="/tags/%E9%9A%8F%E6%83%B3/" style="font-size: 15px;">随想</a> <a href="/tags/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8/" style="font-size: 15px;">字节跳动</a> <a href="/tags/%E6%9C%88%E5%BA%A6%E6%80%BB%E7%BB%93/" style="font-size: 15px;">月度总结</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 15px;">随笔</a> <a href="/tags/CMake/" style="font-size: 15px;">CMake</a> <a href="/tags/makefile/" style="font-size: 15px;">makefile</a> <a href="/tags/%E7%BC%96%E8%AF%91/" style="font-size: 15px;">编译</a> <a href="/tags/CodeLab/" style="font-size: 15px;">CodeLab</a> <a href="/tags/%E5%B0%91%E5%84%BF%E7%BC%96%E7%A8%8B/" style="font-size: 15px;">少儿编程</a> <a href="/tags/%E6%88%91%E7%9A%84%E5%A4%A7%E5%AD%A6/" style="font-size: 15px;">我的大学</a> <a href="/tags/%E5%9B%9E%E5%BF%86%E5%BD%95/" style="font-size: 15px;">回忆录</a> <a href="/tags/crash/" style="font-size: 15px;">crash</a> <a href="/tags/%E9%AA%91%E8%A1%8C/" style="font-size: 15px;">骑行</a> <a href="/tags/%E8%87%AA%E8%A1%8C%E8%BD%A6/" style="font-size: 15px;">自行车</a> <a href="/tags/fcc/" style="font-size: 15px;">fcc</a> <a href="/tags/%E5%88%86%E4%BA%AB/" style="font-size: 15px;">分享</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 15px;">游戏</a> <a href="/tags/ifLab/" style="font-size: 15px;">ifLab</a> <a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 15px;">技术</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size: 15px;">建站</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 15px;">面试</a> <a href="/tags/%E7%A7%9F%E6%88%BF/" style="font-size: 15px;">租房</a> <a href="/tags/iBistu/" style="font-size: 15px;">iBistu</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 15px;">编译原理</a> <a href="/tags/%E7%9D%A1%E9%AD%94/" style="font-size: 15px;">睡魔</a> <a href="/tags/Netflix/" style="font-size: 15px;">Netflix</a> <a href="/tags/%E6%91%84%E5%BD%B1/" style="font-size: 15px;">摄影</a> <a href="/tags/%E4%BD%9C%E5%93%81/" style="font-size: 15px;">作品</a> <a href="/tags/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/" style="font-size: 15px;">开发日志</a> <a href="/tags/App/" style="font-size: 15px;">App</a> <a href="/tags/%E4%BA%A7%E5%93%81%E6%80%9D%E8%80%83/" style="font-size: 15px;">产品思考</a> <a href="/tags/Playground/" style="font-size: 15px;">Playground</a> <a href="/tags/%E5%B7%A5%E4%BD%9C/" style="font-size: 15px;">工作</a> <a href="/tags/SwiftUI/" style="font-size: 15px;">SwiftUI</a> <a href="/tags/%E5%BD%B1%E8%A7%86%E5%89%A7/" style="font-size: 15px;">影视剧</a> <a href="/tags/WWDC/" style="font-size: 15px;">WWDC</a> <a href="/tags/%E5%AD%97%E8%8A%82/" style="font-size: 15px;">字节</a> <a href="/tags/%E8%B7%91%E6%AD%A5/" style="font-size: 15px;">跑步</a> <a href="/tags/%E9%A9%AC%E6%8B%89%E6%9D%BE/" style="font-size: 15px;">马拉松</a> <a href="/tags/%E8%BF%90%E5%8A%A8/" style="font-size: 15px;">运动</a> <a href="/tags/%E8%B6%8A%E9%87%8E%E8%B7%91/" style="font-size: 15px;">越野跑</a> <a href="/tags/%E6%84%9F%E8%B0%A2/" style="font-size: 15px;">感谢</a> <a href="/tags/%E6%BB%B4%E6%BB%B4/" style="font-size: 15px;">滴滴</a> <a href="/tags/%E6%80%9D%E8%80%83/" style="font-size: 15px;">思考</a> <a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 15px;">旅行</a> <a href="/tags/%E6%84%9F%E6%80%A7/" style="font-size: 15px;">感性</a> <a href="/tags/%E9%9D%92%E5%B2%9B/" style="font-size: 15px;">青岛</a> <a href="/tags/%E5%BE%92%E6%AD%A5/" style="font-size: 15px;">徒步</a> <a href="/tags/Unity/" style="font-size: 15px;">Unity</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/WatchOS/" style="font-size: 15px;">WatchOS</a> <a href="/tags/Combine/" style="font-size: 15px;">Combine</a> <a href="/tags/django/" style="font-size: 15px;">django</a> <a href="/tags/%E5%AE%9E%E4%B9%A0/" style="font-size: 15px;">实习</a> <a href="/tags/%E5%BE%AE%E4%BF%A1/" style="font-size: 15px;">微信</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 15px;">小程序</a> <a href="/tags/UML/" style="font-size: 15px;">UML</a> <a href="/tags/%E6%90%9E%E4%BA%8B%E6%83%85%E7%B3%BB%E5%88%97/" style="font-size: 15px;">搞事情系列</a> <a href="/tags/%E4%B8%83%E7%89%9B%E4%BA%91/" style="font-size: 15px;">七牛云</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/Mybatis/" style="font-size: 15px;">Mybatis</a> <a href="/tags/Junit/" style="font-size: 15px;">Junit</a> <a href="/tags/log4j/" style="font-size: 15px;">log4j</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/Spring-MVC/" style="font-size: 15px;">Spring MVC</a> <a href="/tags/%E5%9B%BD%E9%99%85%E5%8C%96/" style="font-size: 15px;">国际化</a> <a href="/tags/%E6%BC%94%E8%AE%B2/" style="font-size: 15px;">演讲</a> <a href="/tags/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF/" style="font-size: 15px;">即时通讯</a> <a href="/tags/side-project/" style="font-size: 15px;">side project</a> <a href="/tags/Qt/" style="font-size: 15px;">Qt</a> <a href="/tags/C-%E8%B7%A8%E7%AB%AF/" style="font-size: 15px;">C++ 跨端</a> <a href="/tags/C/" style="font-size: 15px;">C++</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F/" style="font-size: 15px;">响应式</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 联系我</i></div><ul></ul><a href="https://github.com/windstormeye" title="GitHub - PJHubs" target="_blank">GitHub - PJHubs</a><ul></ul><a href="https://www.xiaohongshu.com/user/profile/5f2cd0360000000001001470" title="小红书 - PJHubs" target="_blank">小红书 - PJHubs</a><ul></ul><a href="https://www.instagram.com/pjhubs/" title="Instagram - PJHubs" target="_blank">Instagram - PJHubs</a><ul></ul><a href="https://space.bilibili.com/25392474" title="BiliBili - PJHubs" target="_blank">BiliBili - PJHubs</a><ul></ul><a href="https://twitter.com/wengpeijun" title="Twitter - PJHubs" target="_blank">Twitter - PJHubs</a><ul></ul><a href="." title="邮箱 - 877302410@qq.com" target="_blank">邮箱 - 877302410@qq.com</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 PJHubs</div></div></div><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>