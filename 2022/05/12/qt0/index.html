<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="也就骑个车，顺便写点码，再去看看景"><title>Qt Project - 播放器 | PJHubs</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Qt Project - 播放器</h1><a id="logo" href="/.">PJHubs</a><p class="description">也就骑个车，顺便写点码，再去看看景</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined"> 文章</i></a><a href="/archives/"><i class="fa undefined"> 总览</i></a><a href="/photograph/"><i class="fa undefined"> 摄影</i></a><a href="/about/"><i class="fa undefined"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Qt Project - 播放器</h1><div class="post-meta">2022-05-12</div><div class="post-content"><p><img src="/images/qiniu_img/20220512160505.png"></p>
<p>距离上一次完整写 Qt 相关的东西已经过去了整整 5 年，上一次写 Qt 时还是使用 Qt Widget，然而现在已经开始推 Qt Quike，并使用 QML 来替换 Widget 组织 UI 结构了。但因切换 CMake 作为构建工具，思维上还是没转换过来为什么 Qt Creator 作为一个 IDE，工程目录没法直接映射。</p>
<h2 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h2><p>基于【███】████ - QML实战（下文称“文档”）之上完成。但该文档中屏蔽掉了较多细节，且有些地方描述得也不是很清晰，中间迷糊了好几次，对完全的新手有些不友好，也咨询一些做过该 demo 的同学，给到的答复是“这已经比我当初看的时候好很多啦！”“大部分的东西还是需要自己去探索”。</p>
<p>拿到这个结论后就可以明确了对这个文档有些虎头蛇尾的感受，确实“有意为之”，让新同学们自己独立起来 ！那么就来看看具体的实现过程吧。</p>
<h2 id="功能点"><a href="#功能点" class="headerlink" title="功能点"></a>功能点</h2><p>在文档中的 demo 基础上拓展了一部分我个人相对感兴趣的点，如“右键菜单”和“窗体缩放”等，具体的功能点有：</p>
<p>播放区</p>
<ul>
<li>视频播放&#x2F;暂停</li>
<li>快进&#x2F;快退 3s<br>素材区</li>
<li>拖拽添加单个&#x2F;多个素材。</li>
<li>鼠标<ul>
<li>左键点击选择，自动播放</li>
<li>右键更多菜单<ul>
<li>删除</li>
<li>复制</li>
</ul>
</li>
</ul>
</li>
<li>图片圆角<br>其它</li>
<li>窗体拖拽</li>
</ul>
<h3 id="工程配置"><a href="#工程配置" class="headerlink" title="工程配置"></a>工程配置</h3><p><strong>CMake</strong><br>刚开始的工程配置就给了一个下马威，先是纠结了一番如何组织 .h 和 .cpp 文件，按照原先的习惯，只要是一个独立的模块，不管是 UI 还是 model 都会单独拎出来一个文件夹。</p>
<p>按照文档中的说明，选择了 CMake 作为工程构建工具，在左侧目录上右键创建 C++ 类却无法自动添加到工程目录中，需要我们手动在 CMakeLists.txt 加上相关的逻辑。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.16)</span><br><span class="line"></span><br><span class="line">project(PlayerDemo VERSION 0.1 LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line">set(CMAKE_AUTOMOC ON)</span><br><span class="line">set(CMAKE_CXX_STANDARD_REQUIRED ON)</span><br><span class="line">set(CMAKE_AUTORCC ON)</span><br><span class="line">set(CMAKE_AUTOUIC ON)</span><br><span class="line"></span><br><span class="line">find_package(Qt6 6.2 COMPONENTS Quick REQUIRED)</span><br><span class="line">find_package(Qt6 6.2 COMPONENTS Multimedia REQUIRED)</span><br><span class="line"></span><br><span class="line">file(GLOB_RECURSE source_files *.c *.cpp)</span><br><span class="line">file(GLOB_RECURSE header_files *.h *.hpp)</span><br><span class="line"></span><br><span class="line">include_directories($&#123;header_files&#125;)</span><br><span class="line"></span><br><span class="line">qt_add_executable(appPlayerDemo</span><br><span class="line">    main.cpp</span><br><span class="line">    qml.qrc</span><br><span class="line">    $&#123;source_files&#125;</span><br><span class="line">    $&#123;header_files&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">#qt_add_qml_module(appPlayerDemo</span><br><span class="line">#    URI PlayerDemo</span><br><span class="line">#    VERSION 1.0</span><br><span class="line">#    QML_FILES main.qml</span><br><span class="line">#)</span><br><span class="line"></span><br><span class="line">set_target_properties(appPlayerDemo PROPERTIES</span><br><span class="line">    MACOSX_BUNDLE_GUI_IDENTIFIER my.example.com</span><br><span class="line">    MACOSX_BUNDLE_BUNDLE_VERSION $&#123;PROJECT_VERSION&#125;</span><br><span class="line">    MACOSX_BUNDLE_SHORT_VERSION_STRING $&#123;PROJECT_VERSION_MAJOR&#125;.$&#123;PROJECT_VERSION_MINOR&#125;</span><br><span class="line">    MACOSX_BUNDLE TRUE</span><br><span class="line">    WIN32_EXECUTABLE TRUE</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">target_compile_definitions(appPlayerDemo</span><br><span class="line">    PRIVATE $&lt;$&lt;OR:$&lt;CONFIG:Debug&gt;,$&lt;CONFIG:RelWithDebInfo&gt;&gt;:QT_QML_DEBUG&gt;)</span><br><span class="line">target_link_libraries(appPlayerDemo</span><br><span class="line">    PRIVATE Qt6::Quick Qt6::Multimedia)</span><br></pre></td></tr></table></figure>

<p>以上内容中需要重点关注的是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file(GLOB_RECURSE source_files *.c *.cpp)​</span><br><span class="line">file(GLOB_RECURSE header_files *.h *.hpp)</span><br></pre></td></tr></table></figure>

<p>自动索引当前目录下所有文件夹中的 .c、.cpp、.h、.hpp 文件，最后通过 <code>qt_add_executable</code> 添加到工程目录中。</p>
<p>如果这是纯手动工程，如使用 VSCode 来进行这么“原始”的操作过程能理解，但已经是一个 IDE，确实不太理解为什么在 IDE 中创建工程不能自动的做到文件索引。</p>
<p><strong>QRC</strong></p>
<p>QRC 是 Qt Creator 中推荐的资源管理方式。这也是不理解的地方，如果是推荐的话，为什么不能够在使用 Qt Creator 的情况下做一些默认行为呢？如果是可选的话，但在后续的 qml 相关文件中对资源的获取又是默认 qrc 方式引用的，我理解的话，既然是可选的是不是应该以“本地引用”的方式为准？</p>
<p>按照文档中的步骤，需要我们手动在 Qt Creator 中创建出 qrc 资源关键文件，并在其中添加进所有的 qml 和图片资源文件。</p>
<p><img src="/images/qiniu_img/20220512162107.png"></p>
<p>实际工程目录结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── helper</span><br><span class="line">│   ├── coverimageprovider.cpp</span><br><span class="line">│   ├── coverimageprovider.h</span><br><span class="line">│   ├── videoinfofetcher.cpp</span><br><span class="line">│   └── videoinfofetcher.h</span><br><span class="line">├── image</span><br><span class="line">│   ├── pic.png</span><br><span class="line">│   ├── .....</span><br><span class="line">│   └── player-track-prev.png</span><br><span class="line">├── main.cpp</span><br><span class="line">├── model</span><br><span class="line">│   ├── ListViewModel</span><br><span class="line">│   │   ├── videoassetmodel.cpp</span><br><span class="line">│   │   └── videoassetmodel.h</span><br><span class="line">│   └── VideoAsset</span><br><span class="line">│       ├── videoasset.cpp</span><br><span class="line">│       └── videoasset.h</span><br><span class="line">├── qml</span><br><span class="line">│   ├── ControlBar.qml</span><br><span class="line">│   ├── Gallery.qml</span><br><span class="line">│   ├── Player.qml</span><br><span class="line">│   └── main.qml</span><br><span class="line">└── qml.qrc</span><br></pre></td></tr></table></figure>

<p>这里也有困惑的地方，按照上图中的文件树 .cpp 和 .h 都在一个文件夹中，但不知道为何 Qt Creator 要单独拆分出 Header Files 和 Source Files。是 CMakeLists.txt 中分开索引了头文件和实现文件？</p>
<p><img src="/images/qiniu_img/20220512162224.png"></p>
<h3 id="功能区划分"><a href="#功能区划分" class="headerlink" title="功能区划分"></a>功能区划分</h3><p>之前未写过任何的桌面应用，在当初使用 FCPX 时就对这种多功能区划分的布局感兴趣，但按照 AppleOS 那一套开发流程，在 iPadOS 上通过 UISplitViewController 来完成左右分栏这种较为固定的分栏方式，灵活度不大。</p>
<p>文档中引导通过 <code>Rectangle</code> 自行划分功能区的方式第一次见，非常不错！在此基础上做了对齐一部分剪映专业版的 UI 增加了部分 <code>margin</code> 和圆角。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">Window</span> &#123;​</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">640</span>​</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">400</span>​</span><br><span class="line">    <span class="attribute">visible</span>: <span class="literal">true</span>​</span><br><span class="line">    <span class="attribute">title</span>: qsTr(<span class="string">&quot;VideoEditorPlayer&quot;</span>)​</span><br><span class="line">    <span class="attribute">color</span>: <span class="string">&quot;black&quot;</span>​</span><br><span class="line">    <span class="attribute">minimumWidth</span>: <span class="number">640</span>​</span><br><span class="line">    <span class="attribute">minimumHeight</span>: <span class="number">400</span>​</span><br><span class="line">​</span><br><span class="line">    <span class="title">Player</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> player</span>​</span><br><span class="line">        <span class="attribute">height</span>: <span class="built_in">parent</span>​</span><br><span class="line">        <span class="attribute">anchors.top</span>: <span class="built_in">parent</span>.top​</span><br><span class="line">        <span class="attribute">anchors.bottom</span>: <span class="built_in">parent</span>.bottom​</span><br><span class="line">        <span class="attribute">anchors.right</span>: gallery.left​</span><br><span class="line">        <span class="attribute">anchors.left</span>: <span class="built_in">parent</span>.left​</span><br><span class="line">        <span class="attribute">anchors.rightMargin</span>: <span class="number">10</span>​</span><br><span class="line">        <span class="attribute">anchors.margins</span>: <span class="number">10</span>​</span><br><span class="line">    &#125;​</span><br><span class="line">​</span><br><span class="line">    <span class="title">Gallery</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> gallery</span>​</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">175</span>​</span><br><span class="line">        <span class="attribute">height</span>: <span class="built_in">parent</span>​</span><br><span class="line">        <span class="attribute">anchors.top</span>: <span class="built_in">parent</span>.top​</span><br><span class="line">        <span class="attribute">anchors.bottom</span>: <span class="built_in">parent</span>.bottom​</span><br><span class="line">        <span class="attribute">anchors.right</span>: <span class="built_in">parent</span>.right​</span><br><span class="line">        <span class="attribute">anchors.margins</span>: <span class="number">10</span>​</span><br><span class="line">        <span class="attribute">onSelectedVideo</span>:(videoUrl) =&gt; &#123;​</span><br><span class="line">            player.playWithVideoUrl(videoUrl)​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过不同 QML 文件组织不同的 UI 组件，如果都在同一个 qrc 目录下可以直接使用不需要 import。</p>
<h3 id="素材区"><a href="#素材区" class="headerlink" title="素材区"></a>素材区</h3><p>素材区整体使用的是 <code>GridView</code>，可以同等认为是 <code>UICollectionView</code>。在实际开发过程中，<code>GridView</code> 和 Cell Component 是要分隔开在不同 qml 文件中的，这里比较奇怪的是，看上去 QML 在 <code>GridView</code> 设置子组件 <code>delegate</code> 有默认参数，如相关的 <code>index</code> 等，可以不用显式的设置直接使用即可。</p>
<p>一般来说，UI 和数据源进行分离是“公理”，而在 QML 中尽可能少的使用 JS 而是使用 C++ 与 QML 交互也是 Qt 里的“公理”，但写着写着就发现如果纯粹是收敛在 QML 中的 UI 展示逻辑，确实 JS 会越写越多，慢慢的，与 C++ 的交互过程就变为了纯粹的数据交换。</p>
<p>需要在手动在注册对应的 C++ model 暴露给 QML 的属性：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++ model.cpp​</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">VideoAssetModel::rowCount</span><span class="params">(<span class="type">const</span> QModelIndex &amp;parent)</span> <span class="type">const</span>​</span></span><br><span class="line"><span class="function"></span>&#123;​</span><br><span class="line">    <span class="keyword">if</span> (parent.<span class="built_in">isValid</span>())​</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;​</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> m_datas.<span class="built_in">count</span>();​</span><br><span class="line">&#125;​</span><br><span class="line">​</span><br><span class="line"><span class="function">QVariant <span class="title">VideoAssetModel::data</span><span class="params">(<span class="type">const</span> QModelIndex &amp;index, <span class="type">int</span> role)</span> <span class="type">const</span>​</span></span><br><span class="line"><span class="function"></span>&#123;​</span><br><span class="line">    <span class="keyword">if</span> (!index.<span class="built_in">isValid</span>())​</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QVariant</span>();​</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">return</span> QVariant::<span class="built_in">fromValue</span>(m_datas[index.<span class="built_in">row</span>()].<span class="built_in">data</span>());​</span><br><span class="line">&#125;​</span><br><span class="line">​</span><br><span class="line"><span class="function">QHash&lt;<span class="type">int</span>, QByteArray&gt; <span class="title">VideoAssetModel::roleNames</span><span class="params">()</span> <span class="type">const</span>​</span></span><br><span class="line"><span class="function"></span>&#123;​</span><br><span class="line">    QHash&lt;<span class="type">int</span>, QByteArray&gt; hash;​</span><br><span class="line">    hash[<span class="number">0</span>] = <span class="string">&quot;asset&quot;</span>;​</span><br><span class="line">    <span class="keyword">return</span> hash;​</span><br><span class="line">&#125;​</span><br><span class="line">​</span><br><span class="line"><span class="comment">// main.cpp​</span></span><br><span class="line"><span class="built_in">qmlRegisterType</span>&lt;VideoAssetModel&gt;(<span class="string">&quot;com.pjhubs.asset&quot;</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="string">&quot;VideoAssetModel&quot;</span>);​</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中，“asset”是是作为 <code>VideoAssetModel</code> 在 QML 中的属性别名，直接标记为当前 <code>index</code> 下关联的 <code>AssetModel</code> 实例，可直接通过别名在 QML 中使用。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">Rectangle</span> &#123;​</span><br><span class="line">    <span class="title">VideoAssetModel</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> videoModel</span>​</span><br><span class="line">    &#125;​</span><br><span class="line">    ​</span><br><span class="line">    <span class="title">Component</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> cell</span>​</span><br><span class="line">        ​</span><br><span class="line">        <span class="title">Column</span> &#123;​</span><br><span class="line">            <span class="title">Image</span> &#123;​</span><br><span class="line">                <span class="attribute">id:</span><span class="string"> coverImg</span>​</span><br><span class="line">                <span class="attribute">source</span>: asset.coverImage​</span><br><span class="line">            &#125;​</span><br><span class="line">            <span class="title">Text</span> &#123;​</span><br><span class="line">                <span class="attribute">id:</span><span class="string"> coverTitle</span>​</span><br><span class="line">                <span class="attribute">text</span>: asset.name​</span><br><span class="line">            &#125;​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">​</span><br><span class="line">    <span class="title">GridView</span> &#123;​</span><br><span class="line">        <span class="attribute">model</span>: videoModel​</span><br><span class="line">        <span class="attribute">delegate</span>: cell​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给 QML 中使用的成员变量需要加上 <code>Q_PROPERTY</code> 进行修饰：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VideoAsset.h​</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString name READ name CONSTANT)​</span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString url READ url CONSTANT)​</span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString coverImage READ coverImage CONSTANT)</span><br></pre></td></tr></table></figure>

<p>给 QML 中调用的方法需要加上 <code>Q_INVOKABLE</code> 进行修饰：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VideoAssetModel.h​</span></span><br><span class="line"><span class="function">Q_INVOKABLE <span class="type">void</span> <span class="title">addVideos</span><span class="params">(<span class="type">const</span> QString &amp;urls)</span></span>;​</span><br><span class="line"><span class="function">Q_INVOKABLE <span class="type">void</span> <span class="title">removeVideo</span><span class="params">(<span class="type">int</span> index)</span></span>;​</span><br><span class="line"><span class="function">Q_INVOKABLE <span class="type">void</span> <span class="title">loadAssets</span><span class="params">()</span></span>;​</span><br><span class="line"><span class="function">Q_INVOKABLE QString <span class="title">urlAt</span><span class="params">(<span class="type">int</span> position)</span></span>;</span><br></pre></td></tr></table></figure>

<p>数据源处理完后，我们来看 UI。按照文档中的意思做到这一部就可以了，但我还是想着把对封面的圆角给加上，当初以为给 <code>Image</code> 组件加圆角直接设置 <code>radius</code> 或者再套一个 <code>Rectangle</code> 就可以了，谁知这一试才发现并不简单。</p>
<p><code>Image</code> 组件没有 <code>radius</code> 属性，套了 <code>Rectangle</code> 后因为无法“裁切”适应导致 <code>Rectangle</code> 的圆角生效了，但 <code>Image</code> 组件没生效。搜了搜资料，发现大家都在使用 Qt5 的 <code>OpacityMask</code> 组件完成，但这个组件在 Qt6 中又被移除了，不作为自带组件集成在 Qt6 中。</p>
<p>这般在 Qt6 中一定会有推荐的圆角设置方法，再探索一番后发现搜到的方法均不可用。最后还是重新打开 MaintenanceTool 下回了 Qt5 的相关组件。</p>
<p><img src="/images/qiniu_img/20220512162650.png"></p>
<p>下载完成后在 QML 文件中即可使用：</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Qt5Compat.GraphicalEffects​</span><br><span class="line">​</span><br><span class="line"><span class="title">Rectangle</span> &#123;​</span><br><span class="line">    <span class="title">VideoAssetModel</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> videoModel</span>​</span><br><span class="line">    &#125;​</span><br><span class="line">​</span><br><span class="line">    <span class="title">Component</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> cell</span>​</span><br><span class="line">​</span><br><span class="line">        <span class="title">Column</span> &#123;​</span><br><span class="line">            <span class="title">Image</span> &#123;​</span><br><span class="line">                <span class="attribute">source</span>: asset.coverImage​</span><br><span class="line">                <span class="attribute">visible</span>: <span class="literal">false</span>​</span><br><span class="line">            &#125;​</span><br><span class="line">            <span class="title">Rectangle</span> &#123;​</span><br><span class="line">                <span class="attribute">id:</span><span class="string"> coverContainer</span>​</span><br><span class="line">                <span class="attribute">visible</span>: <span class="literal">false</span>​</span><br><span class="line">            &#125;​</span><br><span class="line">            <span class="title">OpacityMask</span> &#123;​</span><br><span class="line">                <span class="attribute">id:</span><span class="string"> mask</span>​</span><br><span class="line">                <span class="attribute">width</span>: <span class="built_in">parent</span>.width​</span><br><span class="line">                <span class="attribute">height</span>: coverImg.height​</span><br><span class="line">                <span class="attribute">source</span>: coverImg​</span><br><span class="line">                <span class="attribute">maskSource</span>: coverContainer​</span><br><span class="line">            &#125;​</span><br><span class="line">            <span class="title">Text</span> &#123;​</span><br><span class="line">                <span class="attribute">id:</span><span class="string"> coverTitle</span>​</span><br><span class="line">                <span class="attribute">text</span>: asset.name​</span><br><span class="line">            &#125;​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">​</span><br><span class="line">    <span class="title">GridView</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> listView</span>​</span><br><span class="line">        <span class="attribute">model</span>: videoModel​</span><br><span class="line">        <span class="attribute">delegate</span>: cell​</span><br><span class="line">​</span><br><span class="line">        <span class="attribute">Component.onCompleted</span>: &#123;​</span><br><span class="line">            videoModel.loadAssets()​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;​</span><br></pre></td></tr></table></figure>

<p>素材区的基本 UI 都已完成，再回到数据源上。对于一个简单的素材区来说，支持素材的添加、删除和数据持久化是必然的。前文也已说到，与数据源相关的操作都依赖于 C++ 完成，完整的 <code>VideoAssetmodel</code> 类如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> VIDEOASSETMODEL_H​</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VIDEOASSETMODEL_H​</span></span><br><span class="line">​</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QAbstractListModel&gt;</span>​</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QList&gt;</span>​</span></span><br><span class="line">​</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;../VideoAsset/videoasset.h&quot;</span>​</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VideoAssetModel</span> : <span class="keyword">public</span> QAbstractListModel​</span><br><span class="line">&#123;​</span><br><span class="line">    Q_OBJECT​</span><br><span class="line">​</span><br><span class="line"><span class="keyword">public</span>:​</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">VideoAssetModel</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;​</span><br><span class="line">​</span><br><span class="line">    <span class="function">Q_INVOKABLE <span class="type">void</span> <span class="title">addVideos</span><span class="params">(<span class="type">const</span> QString &amp;urls)</span></span>;​</span><br><span class="line">    <span class="function">Q_INVOKABLE <span class="type">void</span> <span class="title">removeVideo</span><span class="params">(<span class="type">int</span> index)</span></span>;​</span><br><span class="line">    <span class="function">Q_INVOKABLE <span class="type">void</span> <span class="title">loadAssets</span><span class="params">()</span></span>;​</span><br><span class="line">    <span class="function">Q_INVOKABLE QString <span class="title">urlAt</span><span class="params">(<span class="type">int</span> position)</span></span>;​</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">rowCount</span><span class="params">(<span class="type">const</span> QModelIndex &amp;parent = QModelIndex())</span> <span class="type">const</span> <span class="keyword">override</span></span>;​</span><br><span class="line">    <span class="function">QVariant <span class="title">data</span><span class="params">(<span class="type">const</span> QModelIndex &amp;index, <span class="type">int</span> role = Qt::DisplayRole)</span> <span class="type">const</span> <span class="keyword">override</span></span>;​</span><br><span class="line">    <span class="function">QHash&lt;<span class="type">int</span>, QByteArray&gt; <span class="title">roleNames</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>;​</span><br><span class="line">​</span><br><span class="line"><span class="keyword">private</span>:​</span><br><span class="line">    QList&lt;QSharedPointer&lt;VideoAsset&gt;&gt; m_datas;​</span><br><span class="line">    <span class="function">QString <span class="title">fileName</span><span class="params">(<span class="type">const</span> QString urlString)</span></span>;​</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">storeAssets</span><span class="params">()</span></span>;​</span><br><span class="line">&#125;;​</span><br><span class="line">​</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// VIDEOASSETMODEL_H</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;videoassetmodel.h&quot;</span>​</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;../../helper/videoinfofetcher.h&quot;</span>​</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFile&gt;</span>​</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDir&gt;</span>​</span></span><br><span class="line">​</span><br><span class="line">VideoAssetModel::<span class="built_in">VideoAssetModel</span>(QObject *parent)​</span><br><span class="line">    : <span class="built_in">QAbstractListModel</span>(parent)​</span><br><span class="line">&#123;​</span><br><span class="line">&#125;​</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">VideoAssetModel::addVideos</span><span class="params">(<span class="type">const</span> QString &amp;urls)</span>​</span></span><br><span class="line"><span class="function"></span>&#123;​</span><br><span class="line">    QList&lt;QString&gt; urlArr = <span class="built_in">QList</span>&lt;QString&gt;();​</span><br><span class="line">    urlArr.<span class="built_in">append</span>(urls);​</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (urls.<span class="built_in">contains</span>(<span class="string">&quot;,&quot;</span>)) &#123;​</span><br><span class="line">        urlArr = urls.<span class="built_in">split</span>(<span class="string">&quot;,&quot;</span>);​</span><br><span class="line">    &#125;​</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">auto</span> rowCount = m_datas.<span class="built_in">count</span>();​</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">beginInsertRows</span>(<span class="built_in">QModelIndex</span>(), rowCount, rowCount + urlArr.<span class="built_in">count</span>() - <span class="number">1</span>);​</span><br><span class="line">​</span><br><span class="line">    <span class="type">int</span> coverImageCount = <span class="number">0</span>;​</span><br><span class="line">​</span><br><span class="line">    foreach(QString url, urlArr) &#123;​</span><br><span class="line">        QString urlFileName = <span class="built_in">fileName</span>(url);​</span><br><span class="line">​</span><br><span class="line">        VideoInfoFetcher::<span class="built_in">fetchFirstFrameWithVideoUrl</span>(url, [=, &amp;coverImageCount] (<span class="type">const</span> QImage &amp;coverImage) &#123;​</span><br><span class="line">            QString coverDirPath = QDir::<span class="built_in">currentPath</span>() + <span class="string">&quot;/cover_image&quot;</span>;​</span><br><span class="line">            QDir dir;​</span><br><span class="line">            <span class="keyword">if</span> (!dir.<span class="built_in">exists</span>(coverDirPath)) &#123;​</span><br><span class="line">                dir.<span class="built_in">mkdir</span>(coverDirPath);​</span><br><span class="line">            &#125;​</span><br><span class="line">            QString coverImageFilePath = QDir::<span class="built_in">currentPath</span>() + <span class="string">&quot;/cover_image/&quot;</span> + urlFileName + <span class="string">&quot;.jpg&quot;</span>;​</span><br><span class="line">            coverImage.<span class="built_in">save</span>(coverImageFilePath, <span class="string">&quot;jpg&quot;</span>, <span class="number">-1</span>);​</span><br><span class="line">​</span><br><span class="line">            <span class="comment">// <span class="doctag">NOTE:</span> 加上前缀 &quot;file://&quot; 可通过本地文件的方式加载，默认 &quot;qrc://&quot; 方式找图​</span></span><br><span class="line">            <span class="keyword">auto</span> asset = <span class="built_in">QSharedPointer</span>&lt;VideoAsset&gt;(<span class="keyword">new</span> <span class="built_in">VideoAsset</span>(urlFileName, url, <span class="string">&quot;file://&quot;</span> + coverImageFilePath));​</span><br><span class="line">            m_datas.<span class="built_in">append</span>(asset);​</span><br><span class="line">​</span><br><span class="line">            coverImageCount += <span class="number">1</span>;​</span><br><span class="line">            <span class="keyword">if</span> ((coverImageCount == urlArr.<span class="built_in">count</span>() - <span class="number">1</span>) || urlArr.<span class="built_in">count</span>() == <span class="number">1</span>) &#123;​</span><br><span class="line">               <span class="built_in">storeAssets</span>();​</span><br><span class="line">               <span class="built_in">endInsertRows</span>();​</span><br><span class="line">            &#125;​</span><br><span class="line">        &#125;);​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;​</span><br><span class="line">​</span><br><span class="line"><span class="comment">/// 通过 url 获取资源名​</span></span><br><span class="line"><span class="function">QString <span class="title">VideoAssetModel::fileName</span><span class="params">(<span class="type">const</span> QString urlString)</span> </span>&#123;​</span><br><span class="line">    QStringList strings = urlString.<span class="built_in">split</span>(<span class="string">&quot;/&quot;</span>);​</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> / 分割后取最后一段，再 . 分割后取最后一段​</span></span><br><span class="line">    <span class="keyword">return</span> strings.<span class="built_in">last</span>().<span class="built_in">split</span>(<span class="string">&quot;.&quot;</span>).<span class="built_in">first</span>();​</span><br><span class="line">&#125;​</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">VideoAssetModel::removeVideo</span><span class="params">(<span class="type">int</span> index)</span>​</span></span><br><span class="line"><span class="function"></span>&#123;​</span><br><span class="line">    <span class="built_in">beginRemoveRows</span>(<span class="built_in">QModelIndex</span>(), index, index);​</span><br><span class="line">    m_datas.<span class="built_in">removeAt</span>(index);​</span><br><span class="line">    <span class="built_in">endRemoveRows</span>();​</span><br><span class="line">​</span><br><span class="line">    <span class="built_in">storeAssets</span>();​</span><br><span class="line">&#125;​</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">VideoAssetModel::loadAssets</span><span class="params">()</span>​</span></span><br><span class="line"><span class="function"></span>&#123;​</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(<span class="string">&quot;playlist.dat&quot;</span>)</span></span>;​</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">if</span> (file.<span class="built_in">open</span>(QIODevice::ReadOnly | QIODevice::ExistingOnly)) &#123;​</span><br><span class="line">        <span class="function">QDataStream <span class="title">in</span><span class="params">(&amp;file)</span></span>;​</span><br><span class="line">        <span class="type">int</span> num;​</span><br><span class="line">        in &gt;&gt; num;​</span><br><span class="line">        <span class="built_in">beginInsertRows</span>(<span class="built_in">QModelIndex</span>(), <span class="number">0</span>, num - <span class="number">1</span>);​</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;​</span><br><span class="line">            <span class="keyword">auto</span> asset = <span class="built_in">QSharedPointer</span>&lt;VideoAsset&gt;(<span class="keyword">new</span> VideoAsset);​</span><br><span class="line">            asset-&gt;<span class="built_in">read</span>(in);​</span><br><span class="line">            m_datas.<span class="built_in">append</span>(asset);​</span><br><span class="line">        &#125;​</span><br><span class="line">        <span class="built_in">endInsertRows</span>();​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;​</span><br><span class="line">​</span><br><span class="line"><span class="function">QString <span class="title">VideoAssetModel::urlAt</span><span class="params">(<span class="type">int</span> position)</span>​</span></span><br><span class="line"><span class="function"></span>&#123;​</span><br><span class="line">    <span class="keyword">return</span> m_datas.<span class="built_in">at</span>(position)-&gt;<span class="built_in">url</span>();​</span><br><span class="line">&#125;​</span><br><span class="line">​</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">VideoAssetModel::storeAssets</span><span class="params">()</span> </span>&#123;​</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(<span class="string">&quot;playlist.dat&quot;</span>)</span></span>;​</span><br><span class="line">    <span class="keyword">if</span> (file.<span class="built_in">open</span>(QIODevice::WriteOnly)) &#123;​</span><br><span class="line">        <span class="function">QDataStream <span class="title">out</span><span class="params">(&amp;file)</span></span>;​</span><br><span class="line">        <span class="type">int</span> num = m_datas.<span class="built_in">count</span>();​</span><br><span class="line">        out &lt;&lt; num;​</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;​</span><br><span class="line">            m_datas[i]-&gt;<span class="built_in">write</span>(out);​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;​</span><br><span class="line"><span class="comment">// 省略 GridView 数据源方法，前文已列出</span></span><br></pre></td></tr></table></figure>

<p>标记每一个素材资源的 Model 类 <code>VideoAsset</code> 如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VideoAsset</span> : <span class="keyword">public</span> QObject​</span><br><span class="line">&#123;​</span><br><span class="line">    Q_OBJECT​</span><br><span class="line">    <span class="built_in">Q_PROPERTY</span>(QString name READ name CONSTANT)​</span><br><span class="line">    <span class="built_in">Q_PROPERTY</span>(QString url READ url CONSTANT)​</span><br><span class="line">    <span class="built_in">Q_PROPERTY</span>(QString coverImage READ coverImage CONSTANT)​</span><br><span class="line">​</span><br><span class="line"><span class="keyword">public</span>:​</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">VideoAsset</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;​</span><br><span class="line">    <span class="built_in">VideoAsset</span>(<span class="type">const</span> QString &amp;name, <span class="type">const</span> QString &amp;url, <span class="type">const</span> QString &amp;coverImage);​</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="type">const</span> QString &amp;<span class="title">name</span><span class="params">()</span> <span class="type">const</span></span>;​</span><br><span class="line">    <span class="function"><span class="type">const</span> QString &amp;<span class="title">url</span><span class="params">()</span> <span class="type">const</span></span>;​</span><br><span class="line">    <span class="function"><span class="type">const</span> QString &amp;<span class="title">coverImage</span><span class="params">()</span> <span class="type">const</span></span>;​</span><br><span class="line">​</span><br><span class="line">    <span class="function"><span class="type">const</span> QDataStream &amp;<span class="title">read</span><span class="params">(QDataStream &amp;in)</span></span>;​</span><br><span class="line">    <span class="function"><span class="type">const</span> QDataStream &amp;<span class="title">write</span><span class="params">(QDataStream &amp;out)</span></span>;​</span><br><span class="line">    <span class="function"><span class="type">const</span> <span class="type">void</span> <span class="title">setCoverImageUrl</span><span class="params">(<span class="type">const</span> QString coverImageUrl)</span></span>;​</span><br><span class="line">​</span><br><span class="line">signals:​</span><br><span class="line">​</span><br><span class="line"><span class="keyword">private</span>:​</span><br><span class="line">    QString m_name;​</span><br><span class="line">    QString m_url;​</span><br><span class="line">    QString m_coverImage;​</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在获取素材的首帧图这里绕了一个大圈，也有可能是我没理解文档中的方法。大致的思路是通过 Qt 的 <code>QMediaPlayer</code> 组件，单例一个播放器 <code>sharedPlayer</code>，每次外界通过调用播放器播放 <code>play</code> 方法，并通过监听帧变化来获取到第一帧，回调给业务方。</p>
<p>这里我遇到了两个问题，第一个是不知道把生成的 <code>QImage</code> 存在哪里。第二个是 <code>sharedPlayer</code> 播放器单例对象在循环调用场景下会自动停止当前任务，如果我们循环调用四次，让播放器生成四个视频资源的首帧，但因为单例的因素导致只有最后一次播放行为被执行。</p>
<p>第一个问题主要是文档说明了可以通过 <code>QQuickImageProvider</code> 的方式管理图片资源，但经过我的一番尝试后依旧没理解其中的使用方式，后来沿用了之前的思维。既然已经拿到了图片实例，应该保存在 app 沙盒内，让 <code>Image</code> 组件直接加载沙盒路径图片。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">QString coverDirPath = QDir::<span class="built_in">currentPath</span>() + <span class="string">&quot;/cover_image&quot;</span>;​</span><br><span class="line">QDir dir;​</span><br><span class="line"><span class="keyword">if</span> (!dir.<span class="built_in">exists</span>(coverDirPath)) &#123;​</span><br><span class="line">    dir.<span class="built_in">mkdir</span>(coverDirPath);​</span><br><span class="line">&#125;​</span><br><span class="line">QString coverImageFilePath = QDir::<span class="built_in">currentPath</span>() + <span class="string">&quot;/cover_image/&quot;</span> + urlFileName + <span class="string">&quot;.jpg&quot;</span>;​</span><br><span class="line">coverImage.<span class="built_in">save</span>(coverImageFilePath, <span class="string">&quot;jpg&quot;</span>, <span class="number">-1</span>);​</span><br><span class="line">​</span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> 加上前缀 &quot;file://&quot; 可通过本地文件的方式加载，默认 &quot;qrc://&quot; 方式找图​</span></span><br><span class="line"><span class="keyword">auto</span> asset = <span class="built_in">QSharedPointer</span>&lt;VideoAsset&gt;(<span class="keyword">new</span> <span class="built_in">VideoAsset</span>(urlFileName, url, <span class="string">&quot;file://&quot;</span> + coverImageFilePath));​</span><br><span class="line">m_datas.<span class="built_in">append</span>(asset);</span><br></pre></td></tr></table></figure>

<p>需要注意的是，如果对资源并不采用 qrc 进行管理，则需要手动在路径前拼上 <code>file://</code> 转化为本地路径。</p>
<p>第二个问题最开始想着是保持稳定中所给到的方法，继续沿用单例播放器的方式进行，只是问题出在了循环执行上，通过串行队列或者加锁等待的方式即可，这里我最开始使用的是加锁等待，下意识的出现了 OC 中的 barrier，简单好用，但经一番搜索未果，C++ 的加锁还需学习。最终的结局方案为去除播放器单例，每次拖拽视频资源到素材区触发取首帧逻辑时都创建新的播放器。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">VideoInfoFetcher::fetchFirstFrameWithVideoUrl</span><span class="params">(<span class="type">const</span> QString &amp;url, std::function&lt;<span class="type">void</span> (<span class="type">const</span> QImage &amp;)&gt; callback)</span>​</span></span><br><span class="line"><span class="function"></span>&#123;​</span><br><span class="line">    <span class="keyword">auto</span> player = <span class="keyword">new</span> <span class="built_in">QMediaPlayer</span>();​</span><br><span class="line">    player-&gt;<span class="built_in">setSource</span>(<span class="built_in">QUrl</span>(url));​</span><br><span class="line">    <span class="keyword">auto</span> sink = <span class="keyword">new</span> QVideoSink;​</span><br><span class="line">    player-&gt;<span class="built_in">setVideoSink</span>(sink);​</span><br><span class="line">​</span><br><span class="line">    QObject::<span class="built_in">connect</span>(sink, &amp;QVideoSink::videoFrameChanged, player, [=] (<span class="type">const</span> QVideoFrame &amp;frame) &#123;​</span><br><span class="line">        <span class="keyword">if</span> (frame.<span class="built_in">isValid</span>()) &#123;​</span><br><span class="line">            player-&gt;<span class="built_in">stop</span>();​</span><br><span class="line">            <span class="built_in">callback</span>(frame.<span class="built_in">toImage</span>());​</span><br><span class="line">            <span class="keyword">delete</span> player;​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;, Qt::QueuedConnection);​</span><br><span class="line">​</span><br><span class="line">    player-&gt;<span class="built_in">play</span>();​</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，完成了文档中所要求的素材区 UI 和基本操作逻辑，但我在此基础上额外添加了“右键更多菜单”，主要是之前在移动端上的更多菜单都是长按，想尝试一下全新的操作方式。</p>
<p>我没有查过 Qt 是否本身支持“菜单”组件，写到这里时也是下意识的冒出了可以继续使用 <code>rectangle</code> 自定义出一个更多菜单，文档中只要求了“右键删除”，这里的右键菜单多了一个复制功能，复用 <code>addVideo</code> 方法。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">Rectangle</span> &#123;​</span><br><span class="line">    <span class="keyword">property</span><span class="string"> int cellIndex</span>: <span class="number">0</span>​</span><br><span class="line">    <span class="attribute">id:</span><span class="string"> mouseMenu</span>​</span><br><span class="line">    <span class="attribute">visible</span>: <span class="literal">false</span>​</span><br><span class="line">​</span><br><span class="line">    <span class="title">Text</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> deleteItem</span>​</span><br><span class="line">        <span class="attribute">text</span>: qsTr(<span class="string">&quot;删除&quot;</span>)​</span><br><span class="line">​</span><br><span class="line">        <span class="title">MouseArea</span> &#123;​</span><br><span class="line">            <span class="attribute">anchors.fill</span>: <span class="built_in">parent</span>​</span><br><span class="line">            <span class="attribute">onClicked</span>: &#123;​</span><br><span class="line">                videoModel.removeVideo(mouseMenu.cellIndex)​</span><br><span class="line">                mouseMenu.visible = <span class="literal">false</span>​</span><br><span class="line">            &#125;​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">​</span><br><span class="line">    <span class="title">Text</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> copyItem</span>​</span><br><span class="line">        <span class="attribute">text</span>: qsTr(<span class="string">&quot;复制&quot;</span>)​</span><br><span class="line">​</span><br><span class="line">        <span class="title">MouseArea</span> &#123;​</span><br><span class="line">            <span class="attribute">anchors.fill</span>: <span class="built_in">parent</span>​</span><br><span class="line">            <span class="attribute">onClicked</span>: &#123;​</span><br><span class="line">                videoModel.addVideos(videoModel.urlAt(mouseMenu.cellIndex))​</span><br><span class="line">                mouseMenu.visible = <span class="literal">false</span>​</span><br><span class="line">            &#125;​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是完整的“右键菜单” QML 描述，在本次 demo 中，我把右键菜单添加到了 <code>GridView</code> 中，但我不确定类似于“菜单”这种组件目前的 UI 层级是否正确。当光标在素材区的某一个视频 <code>cell</code> 上右键时，通过一发偏移计算，得到每次菜单展示的修正后坐标，特别的地方是需要关注 <code>GridView</code> 的 <code>contentY</code> 值。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">Component</span> &#123;​</span><br><span class="line">    <span class="attribute">id:</span><span class="string"> cell</span>​</span><br><span class="line">    <span class="title">Column</span> &#123;​</span><br><span class="line">        <span class="title">Image</span> &#123;​</span><br><span class="line">            <span class="attribute">id:</span><span class="string"> coverImg</span>​</span><br><span class="line">            <span class="attribute">source</span>: asset.coverImage​</span><br><span class="line">            <span class="attribute">visible</span>: <span class="literal">false</span>​</span><br><span class="line">        &#125;​</span><br><span class="line">​</span><br><span class="line">        <span class="title">Rectangle</span> &#123;​</span><br><span class="line">            <span class="attribute">id:</span><span class="string"> coverContainer</span>​</span><br><span class="line">            <span class="attribute">visible</span>: <span class="literal">false</span>​</span><br><span class="line">        &#125;​</span><br><span class="line">​</span><br><span class="line">        <span class="title">OpacityMask</span> &#123;​</span><br><span class="line">            <span class="attribute">id:</span><span class="string"> mask</span>​</span><br><span class="line">            <span class="attribute">source</span>: coverImg​</span><br><span class="line">            <span class="attribute">maskSource</span>: coverContainer​</span><br><span class="line">​</span><br><span class="line">            <span class="title">MouseArea</span> &#123;​</span><br><span class="line">                <span class="attribute">hoverEnabled</span>: <span class="literal">true</span>​</span><br><span class="line">                <span class="attribute">acceptedButtons</span>: Qt.LeftButton | Qt.RightButton​</span><br><span class="line">                <span class="attribute">onClicked</span>: (mouse) =&gt; &#123;​</span><br><span class="line">                               <span class="keyword">if</span> (mouse.button === Qt.LeftButton) &#123;​</span><br><span class="line">                                   selectedVideo(asset.url)​</span><br><span class="line">                               &#125;​</span><br><span class="line">                               <span class="keyword">if</span> (mouse.button === Qt.RightButton) &#123;​</span><br><span class="line">                                   <span class="keyword">var</span> adjustX = <span class="number">0</span>​</span><br><span class="line">                                   <span class="keyword">var</span> adjustY = <span class="number">0</span>​</span><br><span class="line">                                   <span class="keyword">if</span> (index % <span class="number">2</span>) &#123;​</span><br><span class="line">                                       <span class="comment">// 第二列​</span></span><br><span class="line">                                       adjustX = index % <span class="number">2</span> * listView.cellWidth​</span><br><span class="line">                                   &#125;​</span><br><span class="line">                                   <span class="keyword">if</span> (index / <span class="number">2</span>) &#123;​</span><br><span class="line">                                       adjustY = index / <span class="number">2</span> * listView.cellHeight​</span><br><span class="line">​</span><br><span class="line">                                       <span class="keyword">if</span> (index % <span class="number">2</span>) &#123;​</span><br><span class="line">                                           <span class="comment">// 第二列​</span></span><br><span class="line">                                           adjustY = (index - <span class="number">1</span>) / <span class="number">2</span> * listView.cellHeight​</span><br><span class="line">                                       &#125;​</span><br><span class="line">                                   &#125;​</span><br><span class="line">​</span><br><span class="line">                                   mouseMenu.x = adjustX + mouseX - <span class="number">10</span>​</span><br><span class="line">                                   mouseMenu.y = adjustY + mouseY - listView.contentY - <span class="number">10</span>​</span><br><span class="line">                                   mouseMenu.visible = <span class="literal">true</span>​</span><br><span class="line">                                   mouseMenu.cellIndex = index​</span><br><span class="line">                               &#125;​</span><br><span class="line">                           &#125;​</span><br><span class="line">                <span class="attribute">onExited</span>: &#123;​</span><br><span class="line">                    mouseMenu.visible = <span class="literal">false</span>​</span><br><span class="line">                &#125;​</span><br><span class="line">            &#125;​</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里还有一个 bug，应该要做到当检测到菜单的右值超出了 <code>window</code> 应该要对 <code>x</code> 值减去一个宽度单位，把菜单手动再进行一次偏移，这样就不会出现内容被遮挡的问题了。</p>
<p><img src="/images/qiniu_img/20220512162954.png"></p>
<p>在这里又引发出了我对 <code>GridView</code> 内容刷新的困惑。我估计可能是因为 Qt 想要降低视图刷新的成本，手动要求开发者在对视图进行刷新时插入 <code>beginInsertRows()</code> 和 <code>endInsertRows()</code> 方法来协助 Qt 进行视图刷新的计算，除此之外并未提供其它的视图刷新方式。</p>
<p><code>beginInsertRows()</code> 要求开发者在每次执行视图刷线前都要手动给到刷新的数据范围，比如此时我要复制一个视频，那被刷新的数据源就是“最后一个 <code>index</code>”和“最后一个 <code>index</code> + 1”，需要手动管理被刷新的索引位置。这点我个人是非常喜欢的，目前暂未看到是否 Qt 真的会根据传入的索引范围进行局部刷新，如果真的是局部刷新，这部分的性能开销应该会非常低，好过 <code>reloadData()</code>。</p>
<h3 id="播放区"><a href="#播放区" class="headerlink" title="播放区"></a>播放区</h3><p>播放器区的 UI 主要由 <code>Video</code> 和通过 <code>Rectangle</code> 自定义的控制条组成。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> QtQuick <span class="number">2.0</span>​</span><br><span class="line"><span class="keyword">import</span> QtMultimedia​</span><br><span class="line">​</span><br><span class="line"><span class="title">Rectangle</span> &#123;​</span><br><span class="line">    <span class="title">Video</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> video</span>​</span><br><span class="line">    &#125;​</span><br><span class="line">​</span><br><span class="line">    <span class="title">ControlBar</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> controlBar</span>​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;​</span><br></pre></td></tr></table></figure>

<p>其中自定义的控制条的 ControlBar QML 如下：</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">Rectangle</span> &#123;​</span><br><span class="line">    <span class="attribute">id:</span><span class="string"> root</span>​</span><br><span class="line">    ​</span><br><span class="line">    <span class="keyword">signal</span><span class="string"> playButtonClicked</span>()​</span><br><span class="line">    <span class="keyword">signal</span><span class="string"> preButtonClicked</span>()​</span><br><span class="line">    <span class="keyword">signal</span><span class="string"> nextButtonClicked</span>()​</span><br><span class="line">    ​</span><br><span class="line">    <span class="comment">/// 是否播放​</span></span><br><span class="line">    <span class="keyword">property</span><span class="string"> bool isPlay</span>: <span class="literal">false</span>​</span><br><span class="line">    <span class="comment">/// 当前播放进度​</span></span><br><span class="line">    <span class="keyword">property</span><span class="string"> double currentTime</span>: <span class="number">0</span>​</span><br><span class="line">    <span class="keyword">property</span><span class="string"> double totalTime</span>: <span class="number">0</span>​</span><br><span class="line">    <span class="keyword">property</span><span class="string"> double progressValue</span>: <span class="number">0</span>​</span><br><span class="line">    ​</span><br><span class="line">    <span class="title">Column</span> &#123;​</span><br><span class="line">        <span class="title">Row</span> &#123;​</span><br><span class="line">            <span class="title">Rectangle</span> &#123;​</span><br><span class="line">                <span class="attribute">id:</span><span class="string"> preButton</span>​</span><br><span class="line">                <span class="title">Image</span> &#123;​</span><br><span class="line">                    <span class="attribute">id:</span><span class="string"> preButtonImg</span>​</span><br><span class="line">                    <span class="attribute">source</span>: <span class="string">&quot;qrc:/img/image/player-track-prev.png&quot;</span>​</span><br><span class="line">                    <span class="attribute">fillMode</span>: Image.PreserveAspectFit​</span><br><span class="line">                    <span class="title">ColorOverlay</span> &#123;​</span><br><span class="line">                        <span class="attribute">anchors.fill</span>: preButtonImg​</span><br><span class="line">                        <span class="attribute">source</span>: preButtonImg​</span><br><span class="line">                        <span class="attribute">color</span>: <span class="string">&quot;white&quot;</span>​</span><br><span class="line">                    &#125;​</span><br><span class="line">                &#125;​</span><br><span class="line">            &#125;​</span><br><span class="line">            <span class="title">Rectangle</span> &#123;​</span><br><span class="line">                <span class="attribute">id:</span><span class="string"> playButton</span>​</span><br><span class="line">                <span class="comment">//...​</span></span><br><span class="line">            &#125;​</span><br><span class="line">            <span class="title">Rectangle</span> &#123;​</span><br><span class="line">                <span class="attribute">id:</span><span class="string"> nextButton</span>​</span><br><span class="line">                <span class="comment">//...​</span></span><br><span class="line">            &#125;​</span><br><span class="line">        &#125;​</span><br><span class="line">​</span><br><span class="line">        <span class="title">Row</span> &#123;​</span><br><span class="line">            <span class="attribute">id:</span><span class="string"> progreessBarContainer</span>​</span><br><span class="line">            <span class="title">ProgressBar</span> &#123;​</span><br><span class="line">                <span class="attribute">id:</span><span class="string"> progressBar</span>​</span><br><span class="line">                <span class="attribute">value</span>: progressValue​</span><br><span class="line">            &#125;​</span><br><span class="line">            <span class="title">Label</span> &#123;​</span><br><span class="line">                <span class="attribute">text</span>: formatterTime(currentTime) + <span class="string">&quot;/&quot;</span> + formatterTime(totalTime)​</span><br><span class="line">            &#125;​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;​</span><br></pre></td></tr></table></figure>

<p>文档中提供的 icon 均为黑色，但给的 demo 视频中展示的却是白色，不得不说作者真是个小可爱呐！使用 <code>ColorOverlay</code> 组件即可完成，不过该组件同样在 Qt6 中被移除了，按照前文的方式下载过 Qt5 组件即可。</p>
<p>同步播放器和进度条进度我原本想通过对 <code>progressValue</code> 进行 setter 方法重载，查了一发资料没人说过这个问题，尝试过后才发现原来默认 property 是响应式的，当 QML 组件和 property 关联后，当 property 值发生变换对应的 QML 组件也会发生变化。</p>
<p>这里还需要新增三个控制按钮“快退”、“播放”和“快进”的信号，当光标点击这三个按钮后自动发射对应信号到播放器上。定义和发射信号的方式都比较简单，并没有我当初接触 Qt 时得设置 target 和 connet 等。在对应的 QML 组件上定义到信号函数后，再到对应按钮下的 <code>MouseArea</code> <code>onClicked</code> 信号中发射信号即可。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signal</span><span class="string"> playButtonClicked</span>()​</span><br><span class="line"><span class="keyword">signal</span><span class="string"> preButtonClicked</span>()​</span><br><span class="line"><span class="keyword">signal</span><span class="string"> nextButtonClicked</span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">Rectangle</span> &#123;​</span><br><span class="line">    <span class="attribute">id:</span><span class="string"> preButton</span>​</span><br><span class="line">    <span class="title">Image</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> preButtonImg</span>​</span><br><span class="line">    &#125;​</span><br><span class="line">    <span class="title">MouseArea</span> &#123;​</span><br><span class="line">        <span class="attribute">onClicked</span>: &#123;​</span><br><span class="line">            preButtonClicked()​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而对于播放器 <code>Video</code> 组件来说需要做的事情也不复杂性，无非是在各个信号方法中对 <code>ControlBar</code> 的相关属性进行赋值，即可同步修改 <code>ControlBar</code> UI。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">Window</span> &#123;​</span><br><span class="line">    <span class="attribute">title</span>: qsTr(<span class="string">&quot;VideoEditorPlayer&quot;</span>)​</span><br><span class="line">​</span><br><span class="line">    <span class="title">Player</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> player</span>​</span><br><span class="line">    &#125;​</span><br><span class="line">​</span><br><span class="line">    <span class="title">Gallery</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> gallery</span>​</span><br><span class="line">        <span class="attribute">onSelectedVideo</span>:(videoUrl) =&gt; &#123;​</span><br><span class="line">            player.playWithVideoUrl(videoUrl)​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，我们就完成了文档中所要求的所有功能，但我依旧不满如此。既然做的事情一个播放器 demo，那么这个进度条自动隐藏和展示的功能要补上才算得上是一个较为完整的 demo。</p>
<p>而对控制条进行自动隐藏和展示，主要是利用了 <code>ControlBar</code> 的 <code>visible</code> 属性，并通过使用 <code>Timer</code> 组件进行延时控制。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">Timer</span> &#123;​</span><br><span class="line">    <span class="attribute">id:</span><span class="string"> controlBarTimer</span>​</span><br><span class="line">    <span class="attribute">interval</span>: <span class="number">4000</span>​</span><br><span class="line">    <span class="attribute">repeat</span>: <span class="literal">false</span>​</span><br><span class="line">    <span class="attribute">running</span>: <span class="literal">false</span>​</span><br><span class="line">    <span class="attribute">onTriggered</span>: &#123;​</span><br><span class="line">        controlBar.visible = <span class="literal">false</span>​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着给 <code>Video</code> 组件新增鼠标位置检测，一旦光标进度播放器区域后，自动展示 <code>ControlBar</code></p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">MouseArea</span> &#123;​</span><br><span class="line">    <span class="attribute">anchors.fill</span>: <span class="built_in">parent</span>​</span><br><span class="line">    <span class="attribute">hoverEnabled</span>: <span class="literal">true</span>​</span><br><span class="line">    <span class="attribute">onPositionChanged</span>: &#123;​</span><br><span class="line">        <span class="keyword">if</span> (video.playbackState === MediaPlayer.PlayingState) &#123;​</span><br><span class="line">            controlBar.visible = <span class="literal">true</span>​</span><br><span class="line">            controlBarTimer.start()​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="拖拽"><a href="#拖拽" class="headerlink" title="拖拽"></a>拖拽</h3><p>在观察剪映专业版 app 过程中发现，对窗体进行缩放过程中有部分区域的宽或高不变，部分区域会随着窗体的缩放而变化。一开始以为是某个属性的变化，后来经过一发尝试后发现，仅需固定部分区域宽度，并让其它区域的“左”或者“右”设置为该固定宽度的区域上。</p>
<p>限制窗体整体大小仅需 <code>minimumWidth</code> 即可。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">Window</span> &#123;​</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">640</span>​</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">400</span>​</span><br><span class="line">    <span class="attribute">visible</span>: <span class="literal">true</span>​</span><br><span class="line">    <span class="attribute">title</span>: qsTr(<span class="string">&quot;VideoEditorPlayer&quot;</span>)​</span><br><span class="line">    <span class="attribute">color</span>: <span class="string">&quot;black&quot;</span>​</span><br><span class="line">    <span class="attribute">minimumWidth</span>: <span class="number">640</span>​</span><br><span class="line">    <span class="attribute">minimumHeight</span>: <span class="number">400</span>​</span><br><span class="line">​</span><br><span class="line">    <span class="title">Player</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> player</span>​</span><br><span class="line">        <span class="attribute">height</span>: <span class="built_in">parent</span>​</span><br><span class="line">        <span class="attribute">anchors.top</span>: <span class="built_in">parent</span>.top​</span><br><span class="line">        <span class="attribute">anchors.bottom</span>: <span class="built_in">parent</span>.bottom​</span><br><span class="line">        <span class="attribute">anchors.right</span>: gallery.left​</span><br><span class="line">        <span class="attribute">anchors.left</span>: <span class="built_in">parent</span>.left​</span><br><span class="line">        <span class="attribute">anchors.rightMargin</span>: <span class="number">10</span>​</span><br><span class="line">        <span class="attribute">anchors.margins</span>: <span class="number">10</span>​</span><br><span class="line">    &#125;​</span><br><span class="line">​</span><br><span class="line">    <span class="title">Gallery</span> &#123;​</span><br><span class="line">        <span class="attribute">id:</span><span class="string"> gallery</span>​</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">175</span>​</span><br><span class="line">        <span class="attribute">height</span>: <span class="built_in">parent</span>​</span><br><span class="line">        <span class="attribute">anchors.top</span>: <span class="built_in">parent</span>.top​</span><br><span class="line">        <span class="attribute">anchors.bottom</span>: <span class="built_in">parent</span>.bottom​</span><br><span class="line">        <span class="attribute">anchors.right</span>: <span class="built_in">parent</span>.right​</span><br><span class="line">        <span class="attribute">anchors.margins</span>: <span class="number">10</span>​</span><br><span class="line">        <span class="attribute">onSelectedVideo</span>:(videoUrl) =&gt; &#123;​</span><br><span class="line">            player.playWithVideoUrl(videoUrl)​</span><br><span class="line">        &#125;​</span><br><span class="line">    &#125;​</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>第一次较为完整并成体系的 Qt 桌面应用实战，整体效果而言比之前使用 Qt Widget 的开发方式直观快速了许多，但对 Qt 整体的工程目录组织还是理解到不位，总是觉得正常的目录组织并不是我这样的方式，后续在 CMake 部分会继续加强。Qt 如何导入和使用第三方组件也需继续学习。</p>
<p>对于 QML 组织 UI 的方式很惊艳，虽然之前也有尝试过其它的跨端 UI 组织方式，但目前来说还是相对满意的，有种预感后续可能会纠结在 JS 和 C++ 的数据类型传递上，也没有引入到更多的平台差异性 framework，希望接下来再写的 demo 过程中能够有更多不一样的体会。</p>
</div><div class="tags"><a href="/tags/Qt/"><i class="fa fa-tag"></i>Qt</a><a href="/tags/C-%E8%B7%A8%E7%AB%AF/"><i class="fa fa-tag"></i>C++ 跨端</a></div><div class="post-nav"><a class="pre" href="/2022/05/12/photograph0/">论摄影</a><a class="next" href="/2022/05/07/game12/">文字游戏，勇者与公主</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 15px;">总结</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 15px;">比赛</a> <a href="/tags/Cocos/" style="font-size: 15px;">Cocos</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" style="font-size: 15px;">游戏开发</a> <a href="/tags/DiDi/" style="font-size: 15px;">DiDi</a> <a href="/tags/internship/" style="font-size: 15px;">internship</a> <a href="/tags/Flutter/" style="font-size: 15px;">Flutter</a> <a href="/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0/" style="font-size: 15px;">跨平台</a> <a href="/tags/Audio/" style="font-size: 15px;">Audio</a> <a href="/tags/Ping/" style="font-size: 15px;">Ping</a> <a href="/tags/%E5%BC%B9%E5%B9%95/" style="font-size: 15px;">弹幕</a> <a href="/tags/%E9%A1%B5%E9%9D%A2%E4%BC%A0%E5%80%BC/" style="font-size: 15px;">页面传值</a> <a href="/tags/HUD/" style="font-size: 15px;">HUD</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/%E5%BC%80%E6%BA%90/" style="font-size: 15px;">开源</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 15px;">项目</a> <a href="/tags/PhotosKit/" style="font-size: 15px;">PhotosKit</a> <a href="/tags/React-Native/" style="font-size: 15px;">React-Native</a> <a href="/tags/swift/" style="font-size: 15px;">swift</a> <a href="/tags/Weex/" style="font-size: 15px;">Weex</a> <a href="/tags/Apple/" style="font-size: 15px;">Apple</a> <a href="/tags/%E6%84%9F%E6%83%B3/" style="font-size: 15px;">感想</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">博客</a> <a href="/tags/%E4%BA%91/" style="font-size: 15px;">云</a> <a href="/tags/%E9%9A%8F%E6%83%B3/" style="font-size: 15px;">随想</a> <a href="/tags/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8/" style="font-size: 15px;">字节跳动</a> <a href="/tags/%E6%9C%88%E5%BA%A6%E6%80%BB%E7%BB%93/" style="font-size: 15px;">月度总结</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 15px;">随笔</a> <a href="/tags/CMake/" style="font-size: 15px;">CMake</a> <a href="/tags/makefile/" style="font-size: 15px;">makefile</a> <a href="/tags/%E7%BC%96%E8%AF%91/" style="font-size: 15px;">编译</a> <a href="/tags/CodeLab/" style="font-size: 15px;">CodeLab</a> <a href="/tags/%E5%B0%91%E5%84%BF%E7%BC%96%E7%A8%8B/" style="font-size: 15px;">少儿编程</a> <a href="/tags/%E6%88%91%E7%9A%84%E5%A4%A7%E5%AD%A6/" style="font-size: 15px;">我的大学</a> <a href="/tags/%E5%9B%9E%E5%BF%86%E5%BD%95/" style="font-size: 15px;">回忆录</a> <a href="/tags/crash/" style="font-size: 15px;">crash</a> <a href="/tags/%E9%AA%91%E8%A1%8C/" style="font-size: 15px;">骑行</a> <a href="/tags/%E8%87%AA%E8%A1%8C%E8%BD%A6/" style="font-size: 15px;">自行车</a> <a href="/tags/fcc/" style="font-size: 15px;">fcc</a> <a href="/tags/%E5%88%86%E4%BA%AB/" style="font-size: 15px;">分享</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 15px;">游戏</a> <a href="/tags/ifLab/" style="font-size: 15px;">ifLab</a> <a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 15px;">技术</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size: 15px;">建站</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 15px;">面试</a> <a href="/tags/%E7%A7%9F%E6%88%BF/" style="font-size: 15px;">租房</a> <a href="/tags/iBistu/" style="font-size: 15px;">iBistu</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 15px;">编译原理</a> <a href="/tags/%E7%9D%A1%E9%AD%94/" style="font-size: 15px;">睡魔</a> <a href="/tags/Netflix/" style="font-size: 15px;">Netflix</a> <a href="/tags/%E6%91%84%E5%BD%B1/" style="font-size: 15px;">摄影</a> <a href="/tags/%E4%BD%9C%E5%93%81/" style="font-size: 15px;">作品</a> <a href="/tags/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/" style="font-size: 15px;">开发日志</a> <a href="/tags/App/" style="font-size: 15px;">App</a> <a href="/tags/%E4%BA%A7%E5%93%81%E6%80%9D%E8%80%83/" style="font-size: 15px;">产品思考</a> <a href="/tags/Playground/" style="font-size: 15px;">Playground</a> <a href="/tags/%E5%B7%A5%E4%BD%9C/" style="font-size: 15px;">工作</a> <a href="/tags/SwiftUI/" style="font-size: 15px;">SwiftUI</a> <a href="/tags/%E5%BD%B1%E8%A7%86%E5%89%A7/" style="font-size: 15px;">影视剧</a> <a href="/tags/WWDC/" style="font-size: 15px;">WWDC</a> <a href="/tags/%E5%AD%97%E8%8A%82/" style="font-size: 15px;">字节</a> <a href="/tags/%E8%B7%91%E6%AD%A5/" style="font-size: 15px;">跑步</a> <a href="/tags/%E9%A9%AC%E6%8B%89%E6%9D%BE/" style="font-size: 15px;">马拉松</a> <a href="/tags/%E8%BF%90%E5%8A%A8/" style="font-size: 15px;">运动</a> <a href="/tags/%E8%B6%8A%E9%87%8E%E8%B7%91/" style="font-size: 15px;">越野跑</a> <a href="/tags/%E6%84%9F%E8%B0%A2/" style="font-size: 15px;">感谢</a> <a href="/tags/%E6%BB%B4%E6%BB%B4/" style="font-size: 15px;">滴滴</a> <a href="/tags/%E6%80%9D%E8%80%83/" style="font-size: 15px;">思考</a> <a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 15px;">旅行</a> <a href="/tags/%E6%84%9F%E6%80%A7/" style="font-size: 15px;">感性</a> <a href="/tags/%E9%9D%92%E5%B2%9B/" style="font-size: 15px;">青岛</a> <a href="/tags/%E5%BE%92%E6%AD%A5/" style="font-size: 15px;">徒步</a> <a href="/tags/Unity/" style="font-size: 15px;">Unity</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/WatchOS/" style="font-size: 15px;">WatchOS</a> <a href="/tags/Combine/" style="font-size: 15px;">Combine</a> <a href="/tags/django/" style="font-size: 15px;">django</a> <a href="/tags/%E5%AE%9E%E4%B9%A0/" style="font-size: 15px;">实习</a> <a href="/tags/%E5%BE%AE%E4%BF%A1/" style="font-size: 15px;">微信</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 15px;">小程序</a> <a href="/tags/UML/" style="font-size: 15px;">UML</a> <a href="/tags/%E6%90%9E%E4%BA%8B%E6%83%85%E7%B3%BB%E5%88%97/" style="font-size: 15px;">搞事情系列</a> <a href="/tags/%E4%B8%83%E7%89%9B%E4%BA%91/" style="font-size: 15px;">七牛云</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/Mybatis/" style="font-size: 15px;">Mybatis</a> <a href="/tags/Junit/" style="font-size: 15px;">Junit</a> <a href="/tags/log4j/" style="font-size: 15px;">log4j</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/Spring-MVC/" style="font-size: 15px;">Spring MVC</a> <a href="/tags/%E5%9B%BD%E9%99%85%E5%8C%96/" style="font-size: 15px;">国际化</a> <a href="/tags/%E6%BC%94%E8%AE%B2/" style="font-size: 15px;">演讲</a> <a href="/tags/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF/" style="font-size: 15px;">即时通讯</a> <a href="/tags/side-project/" style="font-size: 15px;">side project</a> <a href="/tags/Qt/" style="font-size: 15px;">Qt</a> <a href="/tags/C-%E8%B7%A8%E7%AB%AF/" style="font-size: 15px;">C++ 跨端</a> <a href="/tags/C/" style="font-size: 15px;">C++</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F/" style="font-size: 15px;">响应式</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 联系我</i></div><ul></ul><a href="https://github.com/windstormeye" title="GitHub - PJHubs" target="_blank">GitHub - PJHubs</a><ul></ul><a href="https://www.xiaohongshu.com/user/profile/5f2cd0360000000001001470" title="小红书 - PJHubs" target="_blank">小红书 - PJHubs</a><ul></ul><a href="https://www.instagram.com/pjhubs/" title="Instagram - PJHubs" target="_blank">Instagram - PJHubs</a><ul></ul><a href="https://space.bilibili.com/25392474" title="BiliBili - PJHubs" target="_blank">BiliBili - PJHubs</a><ul></ul><a href="https://twitter.com/wengpeijun" title="Twitter - PJHubs" target="_blank">Twitter - PJHubs</a><ul></ul><a href="." title="邮箱 - 877302410@qq.com" target="_blank">邮箱 - 877302410@qq.com</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 PJHubs</div></div></div><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>